<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Who the Fact Are You? ‚Äì Engage Squared</title>
  <!-- Google font for a friendly look -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <!-- Font Awesome for per-question icons (with emoji fallback) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Lightweight confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    /*
      Design tokens via CSS variables.
      We flip these in dark mode. The red border matches the Engage Squared brand.
    */
    :root{
      --brand-red: #c41230;
      --bg: #ffffff; --text: #222; --muted: #667085;
      --tile-bg: #fff; --tile-border: #d0d7de; --tile-complete: #e8f5e9;
    }
    [data-theme="dark"]{
      --bg: #0b0f14; --text: #f5f7fa; --muted: #9aa4b2;
      --tile-bg: #121826; --tile-border: #223044; --tile-complete: #0f2b1c;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif; background: var(--bg); color: var(--text); }

    .app { min-height: 100%; display: grid; grid-template-rows: auto auto 1fr auto; border: 10px solid var(--brand-red); }

    header { display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center; padding: 12px 14px; border-bottom: 1px solid var(--tile-border); }
    header .logo { width: 130px; height: auto; object-fit: contain; }
    .brand .subtitle { font-weight: 800; letter-spacing: .2em; color: var(--muted); font-size: 12px; }
    .brand .title { font-size: clamp(18px, 4.2vw, 28px); font-weight: 800; }
    .tags { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: flex-end; }
    .chip { border: 1px solid var(--tile-border); padding: 6px 10px; border-radius: 999px; font-size: 12px; background: var(--tile-bg); }

    .controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 10px 14px; }
    .controls .left, .controls .center, .controls .right { display: flex; gap: 8px; align-items: center; }
    .controls .left { justify-content: flex-start; }
    .controls .center { justify-content: center; }
    .controls .right { justify-content: flex-end; }

    button, select { font: inherit; color: inherit; }
    .btn { border: 1px solid var(--tile-border); background: var(--tile-bg); padding: 10px 12px; border-radius: 12px; cursor: pointer; }
    .btn.primary { background: #111827; color: #fff; border-color: #111827; }
    [data-theme="dark"] .btn.primary { background: #2563eb; border-color: #2563eb; }
    .btn.ghost { background: transparent; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }

    .hint { color: var(--muted); font-size: 12px; }

    /* Board grid ‚Äì switched to 4 columns for 4√ó4 */
    .board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 14px; }

    /*
      Tile styling
      - Perfect 1:1 squares on any screen via aspect-ratio
      - Extra bottom padding so text never collides with the bottom-right icon
    */
    .tile { position: relative; border: 1px solid var(--tile-border); border-radius: 14px; background: var(--tile-bg); text-align: left; padding: 12px 12px 48px 12px; /* reserve space for bottom-right icon */ aspect-ratio: 1 / 1; transition: outline .15s ease, transform .05s ease; }
    .tile:active { transform: translateY(1px); }
    .tile .fact { font-size: clamp(12px, 2.6vw, 15px); line-height: 1.35; font-weight: 600; padding-right: 44px; /* keep text clear of icon */ }

    /* Name + check line under the fact */
    .tile .meta { position: absolute; left: 12px; right: 12px; bottom: 34px; border-top: 1px dashed var(--tile-border); font-size: 12px; line-height: 1.25; padding-top: 6px; display: flex; gap: 6px; align-items: center; }
    .tile .who { font-weight: 700; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* Response text block */
    .tile .entry { position: absolute; left: 12px; right: 12px; bottom: 12px; font-size: 12px; line-height: 1.35; max-height: 3.2em; overflow: hidden; text-overflow: ellipsis; }
    .tile .resp { opacity: .9; }

    .tile.filled { outline: 3px solid #22c55e; background: linear-gradient(180deg, rgba(16,185,129,.15), transparent 50%); }
    .check { width: 18px; height: 18px; border-radius: 50%; background: #22c55e; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 12px; }

    /* Icons ‚Äì now fixed to bottom-right, with emoji fallback if FA fails */
    .tile .fa-icon { position: absolute; right: 10px; bottom: 10px; font-size: 28px; opacity: .22; display: none; pointer-events: none; }
    body.fa-loaded .tile .fa-icon { display: block; }
    .tile .emoji-fallback { position: absolute; right: 10px; bottom: 10px; font-size: 24px; opacity: .45; display: block; pointer-events: none; }
    body.fa-loaded .tile .emoji-fallback { display: none; }

    .footer { padding: 8px 14px 16px; display: flex; align-items: center; justify-content: space-between; }

    /* Dialog (modal) styling */
    dialog.modal { border: none; padding: 0; border-radius: 16px; max-width: min(560px, 92vw); background: var(--bg); color: var(--text); }
    .modal .inner { padding: 16px; }
    .modal h3 { margin: 0 0 8px; }
    .row { display: grid; gap: 8px; margin: 10px 0; }
    textarea { resize: vertical; min-height: 70px; }

    /* Bingo overlay (for big BINGO! and tap-to-dismiss) */
    .bingo-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.4); z-index: 50; }
    .bingo-overlay.show { display: flex; }
    .bingo { font-weight: 800; font-size: min(18vw, 140px); color: #fff; text-shadow: 0 6px 30px rgba(0,0,0,.6); user-select: none; }

    @media (max-width: 560px){
      header { grid-template-columns: 1fr auto; grid-template-areas: 'brand controls'; gap: 8px; }
      header .logo { display: none; }
      .controls { grid-template-columns: 1fr; }
      .footer { flex-direction: column; gap: 6px; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <!-- Logo from the online link you provided. If it ever fails to load due to hotlinking, download & host locally. -->
      <img class="logo" src="https://tse2.mm.bing.net/th/id/OIP.vB2_MMCK6wxXLJRR_2APTgAAAA?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" alt="Engage Squared logo" crossorigin="anonymous" />
      <div class="brand">
        <div class="subtitle">ENGAGE SQUARED</div>
        <div class="title">Who the Fact Are You? üéâ</div>
      </div>
      <div class="tags">
        <span class="chip">Crowd clap on BINGO</span>
        <span class="chip">Randomise √ó3</span>
        <span class="chip">EN / Êó•Êú¨Ë™û / Bahasa</span>
      </div>
    </header>

    <section class="controls">
      <div class="left">
        <label class="hint" for="lang">Language:</label>
        <select id="lang" class="btn">
          <option value="en">English</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
          <option value="id">Bahasa</option>
        </select>
        <label class="hint" for="darkToggle">Dark mode</label>
        <input id="darkToggle" type="checkbox" />
      </div>
      <div class="center">
        <button id="randomBtn" class="btn">Randomise board</button>
        <button id="startBtn" class="btn primary">Start Bingo</button>
        <button id="resetBtn" class="btn" style="display:none">Reset Board</button>
      </div>
      <div class="right">
        <div class="hint" id="preHint">You can shuffle up to 3√ó before starting.</div>
      </div>
    </section>

    <main class="board" id="board" aria-live="polite"></main>

    <footer class="footer">
      <div class="hint" id="progress">0/16 filled ¬∑ 0 bingo lines</div>
      <div class="hint">Made with ‚ù§Ô∏è by your friendly neighbourhood Liam</div>
    </footer>
  </div>

  <!-- Modal for entering Name + Response on a tile -->
  <dialog class="modal" id="modal">
    <div class="inner">
      <h3 id="modalTitle">Add a name & response</h3>
      <div class="row">
        <label for="nameInput" id="nameLabel">Name</label>
        <input id="nameInput" type="text" placeholder="e.g. Alex" />
      </div>
      <div class="row">
        <label for="respInput" id="respLabel">Response</label>
        <textarea id="respInput" placeholder="e.g. Met Chris Hemsworth" ></textarea>
      </div>
      <div class="row" style="display:flex; gap: 8px; justify-content:flex-end;">
        <button id="cancelBtn" class="btn">Cancel</button>
        <button id="saveBtn" class="btn primary">Save</button>
      </div>
    </div>
  </dialog>

  <!-- Overlay for big BINGO! text (tap to dismiss) -->
  <div class="bingo-overlay" id="bingoOverlay"><div class="bingo">BINGO!</div></div>

  <script>
    // ============================
    // Internationalisation strings
    // ============================
    const I18N = {
      en: {
        ui: {
          language: 'Language:', dark: 'Dark mode', randomize: 'Randomise board', start: 'Start Bingo', reset: 'Reset Board',
          prehint: 'You can shuffle up to 3√ó before starting.', howto: 'Tap a tile to enter a name + a short response. Fill lines to get BINGO!',
          add: 'Add a name & response', name: 'Name', response: 'Response', cancel: 'Cancel', save: 'Save',
          filled: (n)=>`${n}/16 filled`, lines: (n)=>`${n} bingo line${n===1?'':'s'}`
        },
        // 40 facts; board chooses 25 random unique items per player
        facts: [
          '‚Ä¶has worked at the company for over 10 years',
          '‚Ä¶has a hidden talent they‚Äôve performed publicly',
          '‚Ä¶has travelled to more than 5 countries',
          '‚Ä¶speaks more than two languages',
          '‚Ä¶has met someone famous',
          '‚Ä¶has run a marathon or completed a major fitness challenge',
          '‚Ä¶has a pet that‚Äôs not a dog or cat',
          '‚Ä¶has lived in more than three cities',
          '‚Ä¶has the same birth month as you',
          '‚Ä¶has worked in a completely different industry before',
          '‚Ä¶has a side hustle or passion project',
          '‚Ä¶has been with the company less than 6 months',
          '‚Ä¶has a unique hobby (e.g., beekeeping, pottery, fencing)',
          '‚Ä¶has never had coffee',
          '‚Ä¶has been on TV or radio',
          '‚Ä¶has a twin or is a twin',
          '‚Ä¶has gone skydiving or bungee jumping',
          '‚Ä¶has a tattoo with a story behind it',
          '‚Ä¶has attended a concert in the last month',
          '‚Ä¶has read more than 20 books this year',
          '‚Ä¶has worked remotely from another country',
          '‚Ä¶has a collection of something unusual',
          '‚Ä¶has been part of a theatre production',
          '‚Ä¶has a nickname they still go by',
          '‚Ä¶has won a competition or award',
          '‚Ä¶has a favourite podcast they recommend',
          '‚Ä¶has a bucket list item they‚Äôve completed',
          '‚Ä¶has a go-to karaoke song',
          '‚Ä¶can do a celebrity impression on the spot',
          '‚Ä¶has a weird food combo they love (and will defend)',
          '‚Ä¶has a pet with a human name',
          '‚Ä¶has tried an extreme sport (and survived)',
          '‚Ä¶has been mistaken for someone famous',
          '‚Ä¶has a viral TikTok or Reel (or knows someone who does)',
          '‚Ä¶has a favourite emoji they overuse',
          '‚Ä¶has a favourite conspiracy theory (for fun!)',
          '‚Ä¶has a favourite fictional character they relate to',
          '‚Ä¶has a story about a travel fail',
          '‚Ä¶has a favourite board game or card game',
          '‚Ä¶has a food they refuse to eat under any circumstance'
        ]
      },
      ja: {
        ui: {
          language: 'Ë®ÄË™ûÔºö', dark: '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ', randomize: '„Éú„Éº„Éâ„Çí„Ç∑„É£„ÉÉ„Éï„É´', start: '„Éì„É≥„Ç¥ÈñãÂßã', reset: '„É™„Çª„ÉÉ„Éà',
          prehint: 'ÈñãÂßãÂâç„ÅØÊúÄÂ§ß3Âõû„Åæ„Åß„Ç∑„É£„ÉÉ„Éï„É´„Åß„Åç„Åæ„Åô„ÄÇ', howto: '„Çø„Ç§„É´„Çí„Çø„ÉÉ„Éó„Åó„Å¶„ÄåÂêçÂâç„Äç„Å®„Äå‰∏ÄË®Ä„Äç„ÇíÂÖ•Âäõ„ÄÇÂàó„ÉªË°å„ÉªÊñú„ÇÅ„Åå„Åù„Çç„ÅÜ„Å® BINGO! ',
          add: 'ÂêçÂâç„Å®‰∏ÄË®Ä„ÇíÂÖ•Âäõ', name: 'ÂêçÂâç', response: '‰∏ÄË®Ä„É°„É¢', cancel: '„Ç≠„É£„É≥„Çª„É´', save: '‰øùÂ≠ò',
          filled: (n)=>`${n}/16 ÂÆå‰∫Ü`, lines: (n)=>`„Éì„É≥„Ç¥ ${n} „É©„Ç§„É≥`
        },
        facts: [
          '‚Ä¶Âã§Á∂ö10Âπ¥‰ª•‰∏ä„ÅÆ‰∫∫', '‚Ä¶‰∫∫Ââç„ÅßÊä´Èú≤„Åó„ÅüÈö†„Çå„ÅüÁâπÊäÄ„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶5„Ç´ÂõΩ‰ª•‰∏ä„Å´ÊóÖË°å„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶2Ë®ÄË™û‰ª•‰∏ä„ÇíË©±„Åõ„Çã‰∫∫', '‚Ä¶ÊúâÂêç‰∫∫„Å´‰ºö„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„Éï„É´„Éû„É©„ÇΩ„É≥„ÇÑÂ§ß„Åç„Å™ÈÅãÂãï„ÉÅ„É£„É¨„É≥„Ç∏„ÇíÈÅîÊàê„Åó„Åü‰∫∫', '‚Ä¶Áä¨„ÇÑÁå´‰ª•Â§ñ„ÅÆ„Éö„ÉÉ„Éà„Åå„ÅÑ„Çã‰∫∫', '‚Ä¶3ÈÉΩÂ∏Ç‰ª•‰∏ä„Å´‰Ωè„Çì„Å†„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„ÅÇ„Å™„Åü„Å®Âêå„ÅòË™ïÁîüÊúà„ÅÆ‰∫∫', '‚Ä¶ÂÖ®„ÅèÈÅï„ÅÜÊ•≠Áïå„ÅßÂÉç„ÅÑ„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÂâØÊ•≠„ÇÑÊÉÖÁÜ±ÁöÑ„Å´Âèñ„ÇäÁµÑ„ÇÄ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÂÖ•Á§æ6„Ç´ÊúàÊú™Ê∫Ä„ÅÆ‰∫∫', '‚Ä¶„É¶„Éã„Éº„ÇØ„Å™Ë∂£Âë≥Ôºà‰æãÔºöÈ§äËúÇ„ÄÅÈô∂Ëä∏„ÄÅ„Éï„Çß„É≥„Ç∑„É≥„Ç∞Ôºâ„ÇíÊåÅ„Å§‰∫∫', '‚Ä¶„Ç≥„Éº„Éí„Éº„ÇíÈ£≤„Çì„Å†„Åì„Å®„Åå„Å™„ÅÑ‰∫∫', '‚Ä¶„ÉÜ„É¨„Éì„ÇÑ„É©„Ç∏„Ç™„Å´Âá∫„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÂèåÂ≠ê„ÄÅ„Åæ„Åü„ÅØÂèåÂ≠ê„ÅÆÂÖÑÂºüÂßâÂ¶π„Åå„ÅÑ„Çã‰∫∫', '‚Ä¶„Çπ„Ç´„Ç§„ÉÄ„Ç§„Éì„É≥„Ç∞„ÇÑ„Éê„É≥„Ç∏„Éº„Ç∏„É£„É≥„Éó„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶Áâ©Ë™û„ÅÆ„ÅÇ„Çã„Çø„Éà„Ç•„Éº„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÈÅéÂéª1„Ç´Êúà„Åß„Ç≥„É≥„Çµ„Éº„Éà„Å´Ë°å„Å£„Åü‰∫∫', '‚Ä¶‰ªäÂπ¥20ÂÜä‰ª•‰∏äÊú¨„ÇíË™≠„Çì„Å†‰∫∫', '‚Ä¶Êµ∑Â§ñ„Åß„É™„É¢„Éº„Éà„ÉØ„Éº„ÇØ„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶Áèç„Åó„ÅÑ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÇíÈõÜ„ÇÅ„Å¶„ÅÑ„Çã‰∫∫', '‚Ä¶ÊºîÂäá„Å´ÂèÇÂä†„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶‰ªä„ÇÇ‰Ωø„Å£„Å¶„ÅÑ„Çã„Éã„ÉÉ„ÇØ„Éç„Éº„É†„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„Ç≥„É≥„ÉÜ„Çπ„Éà„ÇÑË≥û„ÇíÂèóË≥û„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„Åä„Åô„Åô„ÇÅ„ÅÆ„Éù„ÉÉ„Éâ„Ç≠„É£„Çπ„Éà„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„Éê„Ç±„ÉÉ„Éà„É™„Çπ„Éà„ÇíÈÅîÊàê„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„Ç´„É©„Ç™„Ç±„ÅÆÂçÅÂÖ´Áï™„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÊúâÂêç‰∫∫„ÅÆ„É¢„Éé„Éû„Éç„Åå„Åß„Åç„Çã‰∫∫', '‚Ä¶Â§â„Çè„Å£„ÅüÈ£ü„ÅπÂêà„Çè„Åõ„ÅåÂ•Ω„Åç„Å™‰∫∫Ôºà„Åù„Åó„Å¶Ë≠≤„Çâ„Å™„ÅÑÔºâ', '‚Ä¶‰∫∫Èñì„ÅÆÂêçÂâç„ÅÆ„Éö„ÉÉ„Éà„Åå„ÅÑ„Çã‰∫∫', '‚Ä¶„Ç®„ÇØ„Çπ„Éà„É™„Éº„É†„Çπ„Éù„Éº„ÉÑ„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫ÔºàÁîüÈÇÑÊ∏à„ÅøÔºâ', '‚Ä¶ÊúâÂêç‰∫∫„Å´ÈñìÈÅï„Åà„Çâ„Çå„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„Éê„Ç∫„Å£„ÅüTikTok/„É™„Éº„É´„Åå„ÅÇ„ÇãÔºà„ÇÇ„Åó„Åè„ÅØÁü•„ÇäÂêà„ÅÑ„Å´„ÅÑ„ÇãÔºâ', '‚Ä¶„Å§„ÅÑÂ§öÁî®„Åó„Å¶„Åó„Åæ„ÅÜ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÁµµÊñáÂ≠ó„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÔºàÂ®ØÊ•Ω„Å®„Åó„Å¶Ôºâ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈô∞Ë¨ÄË´ñ„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶ÂÖ±ÊÑü„Åô„Çã„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÊû∂Á©∫„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„ÅÑ„Çã‰∫∫', '‚Ä¶ÊóÖË°å„ÅÆÂ§±ÊïóË´á„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆ„Éú„Éº„Éâ„Ç≤„Éº„É†„Éª„Ç´„Éº„Éâ„Ç≤„Éº„É†„Åå„ÅÇ„Çã‰∫∫', '‚Ä¶Áµ∂ÂØæ„Å´È£ü„Åπ„Å™„ÅÑÈ£ü„ÅπÁâ©„Åå„ÅÇ„Çã‰∫∫'
        ]
      },
      id: {
        ui: {
          language: 'Bahasa:', dark: 'Mode Gelap', randomize: 'Acak papan', start: 'Mulai Bingo', reset: 'Reset',
          prehint: 'Sebelum mulai kamu bisa mengacak maksimal 3√ó.', howto: 'Ketuk ubin lalu isi nama + jawaban singkat. Buat garis untuk BINGO!',
          add: 'Tambah nama & jawaban', name: 'Nama', response: 'Jawaban singkat', cancel: 'Batal', save: 'Simpan',
          filled: (n)=>`${n}/16 terisi`, lines: (n)=>`${n} garis bingo`
        },
        facts: [
          '‚Ä¶sudah bekerja di perusahaan lebih dari 10 tahun', '‚Ä¶punya bakat tersembunyi yang pernah ditampilkan', '‚Ä¶pernah ke lebih dari 5 negara', '‚Ä¶bisa berbicara lebih dari dua bahasa', '‚Ä¶pernah bertemu orang terkenal', '‚Ä¶pernah ikut marathon atau tantangan kebugaran besar', '‚Ä¶punya hewan peliharaan selain anjing/kucing', '‚Ä¶pernah tinggal di lebih dari tiga kota', '‚Ä¶punya bulan lahir yang sama denganmu', '‚Ä¶pernah bekerja di industri yang berbeda sama sekali', '‚Ä¶punya usaha sampingan/proyek passion', '‚Ä¶bergabung kurang dari 6 bulan', '‚Ä¶punya hobi unik (mis. beternak lebah, tembikar, anggar)', '‚Ä¶tidak pernah minum kopi', '‚Ä¶pernah muncul di TV/radio', '‚Ä¶punya saudara kembar atau dia kembar', '‚Ä¶pernah skydiving atau bungee jumping', '‚Ä¶punya tato dengan cerita di baliknya', '‚Ä¶pernah nonton konser bulan lalu', '‚Ä¶tahun ini baca >20 buku', '‚Ä¶pernah kerja remote dari luar negeri', '‚Ä¶punya koleksi unik', '‚Ä¶pernah terlibat teater', '‚Ä¶punya nama panggilan yang masih dipakai', '‚Ä¶pernah menang lomba/penghargaan', '‚Ä¶punya podcast favorit', '‚Ä¶pernah menuntaskan bucket list', '‚Ä¶punya lagu karaoke andalan', '‚Ä¶bisa menirukan selebritas', '‚Ä¶suka kombinasi makanan unik (dan akan membelanya!)', '‚Ä¶punya hewan peliharaan bernama manusia', '‚Ä¶pernah coba olahraga ekstrem (dan selamat)', '‚Ä¶pernah dikira orang terkenal', '‚Ä¶punya TikTok/Reel viral (atau kenal yang punya)', '‚Ä¶emoji favorit yang sering dipakai', '‚Ä¶teori konspirasi favorit (sekadar hiburan!)', '‚Ä¶tokoh fiksi favorit yang merepresentasikan diri', '‚Ä¶punya cerita gagal saat traveling', '‚Ä¶punya board/card game favorit', '‚Ä¶ada makanan yang pantang dimakan kapan pun'
        ]
      }
    };

    // Question-to-icon mapping (Font Awesome class + emoji fallback)
    const ICONS = [
      { fa:'fa-briefcase', emoji:'üíº' }, { fa:'fa-masks-theater', emoji:'üé≠' }, { fa:'fa-plane', emoji:'‚úàÔ∏è' }, { fa:'fa-language', emoji:'üó£Ô∏è' },
      { fa:'fa-star', emoji:'‚≠ê' }, { fa:'fa-person-running', emoji:'üèÉ' }, { fa:'fa-paw', emoji:'üêæ' }, { fa:'fa-city', emoji:'üèôÔ∏è' },
      { fa:'fa-cake-candles', emoji:'üéÇ' }, { fa:'fa-industry', emoji:'üè≠' }, { fa:'fa-fire', emoji:'üî•' }, { fa:'fa-user-plus', emoji:'üÜï' },
      { fa:'fa-palette', emoji:'üé®' }, { fa:'fa-mug-saucer', emoji:'‚òï' }, { fa:'fa-tv', emoji:'üì∫' }, { fa:'fa-people-arrows', emoji:'üëØ' },
      { fa:'fa-parachute-box', emoji:'ü™Ç' }, { fa:'fa-signature', emoji:'üñãÔ∏è' }, { fa:'fa-music', emoji:'üéµ' }, { fa:'fa-book', emoji:'üìö' },
      { fa:'fa-globe', emoji:'üåç' }, { fa:'fa-stamp', emoji:'üß∏' }, { fa:'fa-masks-theater', emoji:'üé≠' }, { fa:'fa-user-tag', emoji:'üè∑Ô∏è' },
      { fa:'fa-trophy', emoji:'üèÜ' }, { fa:'fa-podcast', emoji:'üéôÔ∏è' }, { fa:'fa-list-check', emoji:'‚úÖ' }, { fa:'fa-microphone', emoji:'üé§' },
      { fa:'fa-face-smile', emoji:'üòä' }, { fa:'fa-burger', emoji:'üçî' }, { fa:'fa-dog', emoji:'üê∂' }, { fa:'fa-person-hiking', emoji:'ü•æ' },
      { fa:'fa-user-secret', emoji:'üïµÔ∏è' }, { fa:'fa-clapperboard', emoji:'üé¨' }, { fa:'fa-face-grin-hearts', emoji:'üòç' }, { fa:'fa-wand-magic-sparkles', emoji:'‚ú®' },
      { fa:'fa-dice', emoji:'üé≤' }, { fa:'fa-ban', emoji:'üö´' }
    ];

    // ====================
    // State & persistence
    // ====================
    const state = {
      lang: 'en', started: false, randomsLeft: 3, bingoScale: 1,
      grid: [], // holds 16 indices into I18N[lang].facts
      answers: {}, // { [cellIndex]: { name, resp } }
      completedLines: new Set()
    };

    const app = document.getElementById('app');
    const boardEl = document.getElementById('board');
    const randomBtn = document.getElementById('randomBtn');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const progressEl = document.getElementById('progress');
    const preHint = document.getElementById('preHint');
    const langSel = document.getElementById('lang');
    const darkToggle = document.getElementById('darkToggle');

    const modal = document.getElementById('modal');
    const nameInput = document.getElementById('nameInput');
    const respInput = document.getElementById('respInput');
    const cancelBtn = document.getElementById('cancelBtn');
    const saveBtn = document.getElementById('saveBtn');

    const bingoOverlay = document.getElementById('bingoOverlay');

    // Load/save simple state from localStorage
    function saveState(){ localStorage.setItem('wtfay', JSON.stringify({
      lang: state.lang, started: state.started, randomsLeft: state.randomsLeft,
      grid: state.grid, answers: state.answers
    })); }

    function loadState(){
      try {
        const raw = localStorage.getItem('wtfay');
        if (!raw) return;
        const data = JSON.parse(raw);
        state.lang = data.lang ?? state.lang;
        state.started = !!data.started;
        state.randomsLeft = Number.isFinite(data.randomsLeft) ? data.randomsLeft : state.randomsLeft;
        state.grid = Array.isArray(data.grid) ? data.grid.slice(0,16) : state.grid;
        state.answers = data.answers || {};
      } catch(e){ /* ignore */ }
    }

    // Unlock audio on first user gesture (required by browsers)
    let audioCtx = null, unlocked = false;
    function ensureAudio(){ if (!audioCtx){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); } }
    window.addEventListener('pointerdown', ()=>{ ensureAudio(); if (audioCtx.state === 'suspended'){ audioCtx.resume(); } unlocked = true; }, { once: true });

    // Simple crowd clapping synthesized via WebAudio ‚Äì low volume
    function noiseBuffer(){
      // Create white noise buffer
      const samples = 48000 * 0.25; // 0.25s chunk
      const buf = audioCtx.createBuffer(1, samples, 48000);
      const data = buf.getChannelData(0);
      for(let i=0;i<samples;i++){ data[i] = (Math.random()*2-1) * Math.pow(1 - i/samples, 2.2); }
      return buf;
    }
    function playCrowdClap(){
      if (!unlocked) return; // respect autoplay policies
      const master = audioCtx.createGain();
      master.gain.value = 0.25; // gentle volume
      master.connect(audioCtx.destination);
      // Sequence of short clap-like envelopes; slightly staggered to mimic a crowd
      for(let i=0;i<7;i++){
        const t = audioCtx.currentTime + i*0.09;
        const src = audioCtx.createBufferSource(); src.buffer = noiseBuffer();
        const hp = audioCtx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1800;
        const g = audioCtx.createGain(); g.gain.setValueAtTime(0.00001, t); g.gain.linearRampToValueAtTime(1, t+0.012); g.gain.exponentialRampToValueAtTime(0.0001, t+0.14);
        src.connect(hp).connect(g).connect(master);
        src.start(t); src.stop(t+0.22);
      }
    }

    // ====================
    // Font Awesome detect
    // ====================
    function detectFontAwesome(){
      try {
        if (document.fonts && document.fonts.check("1em 'Font Awesome 6 Free'")) {
          document.body.classList.add('fa-loaded');
        } else {
          document.body.classList.remove('fa-loaded');
        }
      } catch(e){ /* best effort */ }
    }

    // ====================
    // Randomisation & board
    // ====================
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    // Create a fresh 4x4 board by sampling 16 unique indices from 40 facts
    function randomiseGrid(){
      const indices = [...Array(40).keys()];
      shuffle(indices);
      state.grid = indices.slice(0,16);
      state.answers = {}; // reset any filled names/responses
      if (!(state.completedLines instanceof Set)) state.completedLines = new Set();
      state.completedLines.clear();
      state.bingoScale = 1; // reset bingo scale so first bingo is base size
      renderBoard();
      updateProgress();
      saveState();
    }

    function tileTextByIndex(idx){ return I18N[state.lang].facts[state.grid[idx]]; }
    function tileIconByIndex(idx){ const factIdx = state.grid[idx]; return ICONS[factIdx] || { fa: 'fa-circle-question', emoji: '‚ùì' }; }

    // ------------------ Board rendering ------------------
    function renderBoard(){
      boardEl.innerHTML = '';
      if (state.grid.length!==16) { // first load
        randomiseGrid();
      }
      for (let idx=0; idx<16; idx++){
        const text = tileTextByIndex(idx);
        const icon = tileIconByIndex(idx);
        const tile = document.createElement('button');
        tile.className = 'tile';
        tile.setAttribute('data-index', idx);
        const entry = state.answers[idx];

        // Show ONLY one Name (next to arrow). Response shows below.
        tile.innerHTML = `
          <i class="fa-solid ${icon.fa} fa-icon" aria-hidden="true"></i>
          <span class="emoji-fallback" aria-hidden="true">${icon.emoji}</span>
          <div class="fact">${text}</div>
          <div class="meta">
            <span class="check" style="display:${entry? 'inline-flex':'none'}">‚úì</span>
            <span class="who" title="name">${entry ? '' + escapeHtml(entry.name) : ''}</span>
          </div>
          ${entry ? `<div class="entry"><div class="resp">${escapeHtml(entry.resp)}</div></div>` : ''}
        `;

        if (entry) tile.classList.add('filled');
        tile.addEventListener('click', ()=> onTileClick(idx, text));
        boardEl.appendChild(tile);
      }
      // After rendering, detect whether Font Awesome actually loaded to toggle FA/emoji
      detectFontAwesome();
    }

    // Escape user text to avoid XSS
    function escapeHtml(str){ return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s])); }

    // ------------------ Modal interaction ------------------
    let currentIdx = null; // the tile index currently being edited
    function onTileClick(idx, factText){
      if (!state.started){
        // Allow up to 3 randomises before start; after starting, disable randomisation
        alert('Tap "Start Bingo" first, then fill tiles. You can shuffle up to 3√ó before starting.');
        return;
      }
      currentIdx = idx;
      document.getElementById('modalTitle').textContent = `${I18N[state.lang].ui.add}`;
      document.getElementById('nameLabel').textContent = I18N[state.lang].ui.name;
      document.getElementById('respLabel').textContent = I18N[state.lang].ui.response;
      document.getElementById('cancelBtn').textContent = I18N[state.lang].ui.cancel;
      document.getElementById('saveBtn').textContent = I18N[state.lang].ui.save;
      nameInput.value = state.answers[idx]?.name || '';
      respInput.value = state.answers[idx]?.resp || '';
      // Some mobile browsers throw on showModal; fall back to open attribute.
      try { modal.showModal(); } catch(e){ modal.setAttribute('open',''); }
      setTimeout(()=>nameInput.focus(), 50);
    }

    function closeModal(){ try { modal.close(); } catch(e){ modal.removeAttribute('open'); } }

    cancelBtn.addEventListener('click', ()=>{ closeModal(); });
    modal.addEventListener('click', (e)=>{ if (e.target === modal) closeModal(); });

    saveBtn.addEventListener('click', ()=>{
      if (currentIdx==null) return;
      const name = nameInput.value.trim();
      const resp = respInput.value.trim();
      if (!name){ nameInput.focus(); return; }
      state.answers[currentIdx] = { name, resp };
      closeModal();
      renderBoard();
      checkForNewBingo();
      updateProgress();
      saveState();
    });

    // Update the progress text (now 16 tiles)
    function updateProgress(){
      const filled = Object.keys(state.answers).length;
      const lines = calculateBingoLines();
      progressEl.textContent = `${I18N[state.lang].ui.filled(filled)} ¬∑ ${I18N[state.lang].ui.lines(lines.size)}`;
    }

    // Compute all completed lines as a Set of line indices (0..9)
    function calculateBingoLines(){
      const filled = new Set(Object.keys(state.answers).map(Number));
      const lines = [];
      for (let r=0;r<4;r++){ lines.push([0,1,2,3].map(c=>r*4+c)); } // rows
      for (let c=0;c<4;c++){ lines.push([0,1,2,3].map(r=>r*4+c)); } // columns
      lines.push([0,5,10,15]); // diag TL‚ÜíBR
      lines.push([3,6,9,12]); // diag TR‚ÜíBL
      const completed = new Set();
      lines.forEach((l,i)=>{ if(l.every(x=>filled.has(x))) completed.add(i); });
      return completed;
    }

    // If there are newly completed lines since last check, celebrate
    function checkForNewBingo(){
      const now = calculateBingoLines();
      const prev = (state.completedLines instanceof Set) ? state.completedLines : new Set();
      const newOnes = [...now].filter(i=>!prev.has(i));
      if (newOnes.length){
        state.completedLines = now;
        state.bingoScale *= 1.5; // 50% bigger each new BINGO
        playCrowdClap();         // gentle crowd clapping sound
        showBingo();             // confetti + overlay
      }
      updateProgress();
      saveState();
    }

    // Display scalable BINGO + confetti; tap to dismiss
    function showBingo(){
      const s = Math.min(1.0 * state.bingoScale, 4); // clamp max size
      bingoOverlay.querySelector('.bingo').style.transform = `scale(${s})`;
      bingoOverlay.classList.add('show');
      const end = Date.now() + 600;
      (function frame(){
        confetti({ particleCount: 12, spread: 60, startVelocity: 24, origin: { y: 0.6 }, scalar: s*0.8 });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }
    bingoOverlay.addEventListener('click', ()=> bingoOverlay.classList.remove('show'));

    // --------------- Language & theme ---------------
    function applyLang(){
      const ui = I18N[state.lang].ui;
      document.querySelector('label[for="lang"]').textContent = ui.language;
      document.querySelector('label[for="darkToggle"]').textContent = ui.dark;
      randomBtn.textContent = ui.randomize;
      startBtn.textContent = ui.start;
      resetBtn.textContent = ui.reset;
      preHint.textContent = ui.prehint;
      updateProgress();
      renderBoard();
    }

    langSel.addEventListener('change', ()=>{ state.lang = langSel.value; saveState(); applyLang(); });
    darkToggle.addEventListener('change', ()=>{ document.documentElement.dataset.theme = darkToggle.checked ? 'dark' : ''; });

    // --------------- Start / Reset / Randomise ---------------
    randomBtn.addEventListener('click', ()=>{
      if (state.started) return; // lock after start
      if (state.randomsLeft <= 0) return;
      state.randomsLeft--; randomiseGrid();
      randomBtn.textContent = `${I18N[state.lang].ui.randomize} (${state.randomsLeft} left)`;
    });

    startBtn.addEventListener('click', ()=>{
      if (!state.started){
        state.started = true;
        preHint.textContent = I18N[state.lang].ui.howto;
        randomBtn.disabled = true;
        startBtn.style.display = 'none';
        resetBtn.style.display = 'inline-block';
        saveState();
      } else {
        // If clicked again (safety), this acts as reset
        state.started = false;
        state.randomsLeft = 3;
        state.answers = {};
        state.completedLines.clear();
        state.bingoScale = 1;
        randomBtn.disabled = false;
        startBtn.style.display = 'inline-block';
        resetBtn.style.display = 'none';
        randomBtn.textContent = I18N[state.lang].ui.randomize;
        renderBoard();
        updateProgress();
        saveState();
      }
    });

    resetBtn.addEventListener('click', ()=>{
      // Reset answers and allow randomise again
      state.started = false; state.randomsLeft = 3; state.answers = {}; state.completedLines.clear(); state.bingoScale = 1;
      randomBtn.disabled = false; startBtn.style.display = 'inline-block'; resetBtn.style.display = 'none';
      randomBtn.textContent = I18N[state.lang].ui.randomize;
      renderBoard();
      updateProgress();
      saveState();
    });

    // ===============
    // Initial boot
    // ===============
    loadState();
    // Ensure we always have a 4x4 grid in memory
    if (!Array.isArray(state.grid) || state.grid.length !== 16){
      state.grid = []; // trigger first-time randomise
    }
    applyLang();
    renderBoard();

    // --------- Inline tests (kept, updated for 4√ó4) ---------
    function bingoLinesFromAnswers(answers){
      const filled = new Set(Object.keys(answers).map(Number));
      const lines = [];
      for (let r=0;r<4;r++){ lines.push([0,1,2,3].map(c=>r*4+c)); }
      for (let c=0;c<4;c++){ lines.push([0,1,2,3].map(r=>r*4+c)); }
      lines.push([0,5,10,15]);
      lines.push([3,6,9,12]);
      const completed = new Set();
      lines.forEach((l,i)=>{ if(l.every(x=>filled.has(x))) completed.add(i); });
      return completed;
    }
    // Test 2: Row bingo
    const row = {0:{},1:{},2:{},3:{}};
    console.assert(bingoLinesFromAnswers(row).size===1, 'row should be 1 bingo');
    // Test 3: Column bingo
    const col = {0:{},4:{},8:{},12:{}};
    console.assert(bingoLinesFromAnswers(col).size===1, 'column should be 1 bingo');
    // Test 4: Diagonal bingo
    const diag = {0:{},5:{},10:{},15:{}};
    console.assert(bingoLinesFromAnswers(diag).size===1, 'diagonal should be 1 bingo');
    // Test 5: Two lines (row + column share cell 0)
    const two = {0:{},1:{},2:{},3:{},4:{},8:{},12:{}};
    console.assert(bingoLinesFromAnswers(two).size===2, 'two lines should be 2 bingos');
  </script>
</body>
</html>
