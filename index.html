<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Who the Fact Are You? ‚Äì Engage Squared</title>
  <!-- Google font for a friendly look -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <!-- Font Awesome for per-question icons (plus we provide emoji fallback) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Lightweight confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    /*
      Design tokens via CSS variables.
      We flip these in dark mode by changing the body class.
    */
    :root {
      --brand-red: #e53935; /* red pulled from/near logo */
      --bg: #ffffff;
      --text: #111111;
      --muted: #6b7280;
      --tile: #fafafa;
      --tile-border: #ececec;
      --accent: #ef4444;
    }
    body.dark {
      --bg: #0b0e16;
      --text: #ffffff;
      --muted: #d1d5db;
      --tile: #111827;
      --tile-border: #1f2937;
      --accent: #f87171;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }

    /* Red border around the entire screen per request */
    .app-wrapper {
      min-height: 100dvh;
      border: 10px solid var(--brand-red);
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 14px 8px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 12px;
      align-items: center;
    }
    header img.logo { width: 52px; height: 52px; border-radius: 10px; object-fit: contain; background: #fff; }
    .brand { line-height: 1.1; }
    .brand .title { font-weight: 800; font-size: clamp(22px, 6vw, 34px); }
    .brand .subtitle { font-weight: 600; color: var(--muted); font-size: clamp(12px, 2.6vw, 14px); letter-spacing: 1px; text-transform: uppercase; }

    .controls {
      padding: 8px 14px 12px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: center;
    }
    .control-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    select, button, input[type="text"], textarea {
      background: var(--tile);
      color: var(--text);
      border: 1px solid var(--tile-border);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 14px;
    }
    button {
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 1px 0 rgba(0,0,0,0.04);
      transition: transform .05s ease, filter .2s ease;
    }
    button:active { transform: translateY(1px); }
    .primary { background: var(--accent); color: #fff; border: none; }
    .ghost { background: transparent; }
    .pill { border-radius: 999px; }
    .hint { font-size: 12px; color: var(--muted); }

    /* BOARD: switched to 4√ó4 */
    .board {
      padding: 10px 14px 22px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      flex: 1;
    }
    .tile {
      background: var(--tile);
      border: 1px solid var(--tile-border);
      border-radius: 18px;
      /* Use aspect-ratio to force 1:1 squares on all screens */
      aspect-ratio: 1 / 1;
      /* keep a sensible minimum height for larger screens */
      min-height: min(18vh, 142px);
      display: flex;
      flex-direction: column;
      padding: 12px 12px 44px 12px; /* extra bottom padding so text doesn't overlap icon */
      position: relative;
      overflow: hidden;
      text-align: left;
    }
    .tile .fact { font-size: clamp(12px, 2.6vw, 15px); line-height: 1.25; font-weight: 600; padding-right: 6px; }

    /* Icon handling: prefer FA when loaded; otherwise show emoji fallback */
    /* Icons moved to bottom-right to avoid covering text */
    .tile .fa-icon { position: absolute; right: 10px; bottom: 10px; opacity: .22; font-size: 28px; display: none; }
    .tile .emoji-fallback { position: absolute; right: 10px; bottom: 10px; opacity: .22; font-size: 28px; display: inline-block; }
    body.fa-loaded .tile .fa-icon { display: inline-block; }
    body.fa-loaded .tile .emoji-fallback { display: none; }

    .tile .meta { margin-top: 8px; font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 6px; }
    .tile .entry { margin-top: 6px; padding-top: 6px; border-top: 1px dashed var(--tile-border); font-size: 12px; line-height: 1.25; }
    .tile .who { font-weight: 700; }
    .tile .resp { margin-top: 2px; opacity: .9; }
    .tile.filled { outline: 3px solid #22c55e; background: linear-gradient(180deg, rgba(16,185,129,.15), transparent 50%); }
    .check { width: 18px; height: 18px; border-radius: 50%; background: #22c55e; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 12px; }

    .footer { padding: 8px 14px 16px; display: flex; align-items: center; justify-content: space-between; }

    /* Dialog (modal) styling */
    dialog.modal { border: none; padding: 0; border-radius: 16px; width: min(560px, 92vw); background: var(--bg); color: var(--text); }
    .modal .inner { padding: 16px; }
    .modal h3 { margin: 0 0 8px; }
    .row { display: grid; gap: 8px; margin: 10px 0; }
    textarea { resize: vertical; min-height: 70px; }

    /* Bingo overlay (for big BINGO! and tap-to-dismiss) */
    .bingo-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.4); z-index: 50; }
    .bingo-overlay.show { display: flex; }
    .bingo-text { font-weight: 800; font-size: 64px; color: #fff; text-shadow: 0 6px 22px rgba(0,0,0,.55); }

    .tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .tag { font-size: 11px; padding: 4px 8px; background: #fee2e2; color: #991b1b; border-radius: 999px; }
    body.dark .tag { background: #7f1d1d; color: #fee2e2; }

    @media (min-width: 860px) { .controls { grid-template-columns: 1fr 1fr 1fr; } }
  </style>
</head>
<body>
  <div class="app-wrapper" id="app">
    <header>
      <!-- Logo from the online link you provided. If it ever fails to load due to hotlinking, download & host locally. -->
      <img class="logo" src="https://tse2.mm.bing.net/th/id/OIP.vB2_MMCK6wxXLJRR_2APTgAAAA?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" alt="Engage Squared logo" crossorigin="anonymous" />
      <div class="brand">
        <div class="subtitle">ENGAGE SQUARED</div>
        <div class="title">Who the Fact Are You? üéâ</div>
      </div>
      <div class="tags">
        <span class="tag" id="darkTag">‚òæ Dark</span>
        <span class="tag">4√ó4 Bingo</span>
      </div>
    </header>

    <section class="controls">
      <div class="control-row">
        <label for="langSel" id="langLabel">Language:</label>
        <select id="langSel" aria-label="Language">
          <option value="en">English</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
          <option value="id">Bahasa Indonesia</option>
        </select>
        <button id="darkToggle" class="ghost pill" aria-pressed="false">üåô Dark mode</button>
      </div>
      <div class="control-row">
        <button id="randomBtn" class="pill">üîÄ <span data-i18n="randomize">Randomise board</span> (<span id="rndLeft">3</span>)</button>
        <button id="startBtn" class="primary pill">‚ñ∂ <span data-i18n="start">Start Bingo</span></button>
        <div class="hint" id="preHint">You can shuffle up to 3√ó before starting.</div>
      </div>
      <div class="control-row">
        <div class="hint" id="howto">Tap a tile to enter a name + a short response. Fill lines to get BINGO!</div>
      </div>
    </section>

    <main class="board" id="board" aria-live="polite"></main>

    <footer class="footer">
      <div class="hint" id="progress">0/16 filled ¬∑ 0 bingo lines</div>
      <div class="hint">Made with ‚ù§Ô∏è by your friendly neighbourhood Liam</div>
    </footer>
  </div>

  <!-- Modal for entering Name + Response on a tile -->
  <dialog class="modal" id="entryModal">
    <form method="dialog" class="inner">
      <h3 id="modalTitle">Add a name & response</h3>
      <div id="modalFact" class="hint"></div>
      <div class="row">
        <label id="nameLabel" for="nameInput">Name</label>
        <input id="nameInput" type="text" placeholder="Type their name" required />
      </div>
      <div class="row">
        <label id="respLabel" for="respInput">Response</label>
        <textarea id="respInput" placeholder="A few words‚Ä¶" required></textarea>
      </div>
      <div class="control-row" style="justify-content: end;">
        <button value="cancel" class="ghost" id="cancelBtn">Cancel</button>
        <button value="confirm" class="primary" id="saveBtn">Save</button>
      </div>
    </form>
  </dialog>

  <!-- Bingo Overlay (confetti + scalable BINGO!) -->
  <div class="bingo-overlay" id="bingoOverlay">
    <div class="bingo-text" id="bingoText">BINGO!</div>
  </div>

  <script>
    // ============================
    // Internationalisation (i18n)
    // ============================
    const I18N = {
      en: {
        ui: {
          language: 'Language:', dark: 'Dark mode', randomize: 'Randomise board', start: 'Start Bingo', reset: 'Reset Board',
          prehint: 'You can shuffle up to 3√ó before starting.', howto: 'Tap a tile to enter a name + a short response. Fill lines to get BINGO!',
          add: 'Add a name & response', name: 'Name', response: 'Response', cancel: 'Cancel', save: 'Save',
          filled: (n)=>`${n}/16 filled`, lines: (n)=>`${n} bingo line${n===1?'':'s'}`
        },
        // 40 facts; board chooses 16 random unique items per player
        facts: [
          '‚Ä¶has worked at the company for over 10 years',
          '‚Ä¶has a hidden talent they‚Äôve performed publicly',
          '‚Ä¶has travelled to more than 5 countries',
          '‚Ä¶speaks more than two languages',
          '‚Ä¶has met someone famous',
          '‚Ä¶has run a marathon or completed a major fitness challenge',
          '‚Ä¶has a pet that‚Äôs not a dog or cat',
          '‚Ä¶has lived in more than three cities',
          '‚Ä¶has the same birth month as you',
          '‚Ä¶has worked in a completely different industry before',
          '‚Ä¶has a side hustle or passion project',
          '‚Ä¶has been with the company less than 6 months',
          '‚Ä¶has a unique hobby (e.g., beekeeping, pottery, fencing)',
          '‚Ä¶has never had coffee',
          '‚Ä¶has been on TV or radio',
          '‚Ä¶has a twin or is a twin',
          '‚Ä¶has gone skydiving or bungee jumping',
          '‚Ä¶has a tattoo with a story behind it',
          '‚Ä¶has attended a concert in the last month',
          '‚Ä¶has read more than 20 books this year',
          '‚Ä¶has worked remotely from another country',
          '‚Ä¶has a collection of something unusual',
          '‚Ä¶has been part of a theatre production',
          '‚Ä¶has a nickname they still go by',
          '‚Ä¶has won a competition or award',
          '‚Ä¶has a favourite podcast they recommend',
          '‚Ä¶has a bucket list item they‚Äôve completed',
          '‚Ä¶has a go-to karaoke song',
          '‚Ä¶can do a celebrity impression on the spot',
          '‚Ä¶has a weird food combo they love (and will defend)',
          '‚Ä¶has a pet with a human name',
          '‚Ä¶has tried an extreme sport (and survived)',
          '‚Ä¶has been mistaken for someone famous',
          '‚Ä¶has a viral TikTok or Reel (or knows someone who does)',
          '‚Ä¶has a favourite emoji they overuse',
          '‚Ä¶has a favourite conspiracy theory (for fun!)',
          '‚Ä¶has a favourite fictional character they relate to',
          '‚Ä¶has a story about a travel fail',
          '‚Ä¶has a favourite board game or card game',
          '‚Ä¶has a food they refuse to eat under any circumstance'
        ]
      },
      ja: {
        ui: {
          language: 'Ë®ÄË™ûÔºö', dark: '„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ', randomize: '„Éú„Éº„Éâ„Çí„Ç∑„É£„ÉÉ„Éï„É´', start: '„Éì„É≥„Ç¥ÈñãÂßã', reset: '„É™„Çª„ÉÉ„Éà',
          prehint: 'ÈñãÂßãÂâç„ÅØÊúÄÂ§ß3Âõû„Åæ„Åß„Ç∑„É£„ÉÉ„Éï„É´„Åß„Åç„Åæ„Åô„ÄÇ', howto: '„Çø„Ç§„É´„Çí„Çø„ÉÉ„Éó„Åó„Å¶„ÄåÂêçÂâç„Äç„Å®„Äå‰∏ÄË®Ä„Äç„ÇíÂÖ•Âäõ„ÄÇÂàó„ÉªË°å„ÉªÊñú„ÇÅ„Åå„Åù„Çç„ÅÜ„Å® BINGO! ',
          add: 'ÂêçÂâç„Å®‰∏ÄË®Ä„ÇíÂÖ•Âäõ', name: 'ÂêçÂâç', response: '‰∏ÄË®Ä„É°„É¢', cancel: '„Ç≠„É£„É≥„Çª„É´', save: '‰øùÂ≠ò',
          filled: (n)=>`${n}/16 ÂÆå‰∫Ü`, lines: (n)=>`„Éì„É≥„Ç¥ ${n} „É©„Ç§„É≥`
        },
        facts: [
          '‚Ä¶Âã§Á∂ö10Âπ¥‰ª•‰∏ä„ÅÆ‰∫∫',
          '‚Ä¶‰∫∫Ââç„ÅßÊä´Èú≤„Åó„ÅüÈö†„Çå„ÅüÁâπÊäÄ„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶5„Ç´ÂõΩ‰ª•‰∏ä„Å´ÊóÖË°å„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶3Ë®ÄË™û‰ª•‰∏ä„ÇíË©±„Åõ„Çã‰∫∫',
          '‚Ä¶ÊúâÂêç‰∫∫„Å´‰ºö„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Éï„É´„Éû„É©„ÇΩ„É≥„ÇÑÂ§ß„Åç„Å™„Éï„Ç£„ÉÉ„Éà„Éç„ÇπÊåëÊà¶„ÇíÂÆåËµ∞„Åó„Åü‰∫∫',
          '‚Ä¶Áä¨„ÉªÁå´‰ª•Â§ñ„ÅÆ„Éö„ÉÉ„Éà„ÇíÈ£º„Å£„Å¶„ÅÑ„Çã‰∫∫',
          '‚Ä¶3ÈÉΩÂ∏Ç‰ª•‰∏ä„Å´‰Ωè„Çì„Å†„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„ÅÇ„Å™„Åü„Å®Âêå„ÅòË™ïÁîüÊúà„ÅÆ‰∫∫',
          '‚Ä¶„Åæ„Å£„Åü„ÅèÂà•Ê•≠Áïå„ÅßÂÉç„ÅÑ„Å¶„ÅÑ„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÂâØÊ•≠„ÇÑÊÉÖÁÜ±„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÂÖ•Á§æ„Åó„Å¶6„ÅãÊúàÊú™Ê∫Ä„ÅÆ‰∫∫',
          '‚Ä¶Áèç„Åó„ÅÑË∂£Âë≥Ôºà‰æãÔºöÈ§äËúÇ„ÉªÈô∂Ëä∏„Éª„Éï„Çß„É≥„Ç∑„É≥„Ç∞Ôºâ„ÇíÊåÅ„Å§‰∫∫',
          '‚Ä¶„Ç≥„Éº„Éí„Éº„ÇíÈ£≤„Çì„Å†„Åì„Å®„Åå„Å™„ÅÑ‰∫∫',
          '‚Ä¶„ÉÜ„É¨„Éì„ÇÑ„É©„Ç∏„Ç™„Å´Âá∫„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÂèåÂ≠ê„ÄÅ„Åæ„Åü„ÅØÂèåÂ≠ê„ÅÆÂÖÑÂºüÂßâÂ¶π„Åå„ÅÑ„Çã‰∫∫',
          '‚Ä¶„Çπ„Ç´„Ç§„ÉÄ„Ç§„Éì„É≥„Ç∞„ÇÑ„Éê„É≥„Ç∏„Éº„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Çπ„Éà„Éº„É™„Éº„ÅÆ„ÅÇ„Çã„Çø„Éà„Ç•„Éº„ÇíÂÖ•„Çå„Å¶„ÅÑ„Çã‰∫∫',
          '‚Ä¶Áõ¥Ëøë1„ÅãÊúà„Åß„Ç≥„É≥„Çµ„Éº„Éà„Å´Ë°å„Å£„Åü‰∫∫',
          '‚Ä¶‰ªäÂπ¥20ÂÜä‰ª•‰∏äÊú¨„ÇíË™≠„Çì„Å†‰∫∫',
          '‚Ä¶Êµ∑Â§ñ„Åã„Çâ„É™„É¢„Éº„ÉàÂã§Âãô„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Å°„Çá„Å£„Å®Â§â„Çè„Å£„Åü„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÇíÈõÜ„ÇÅ„Å¶„ÅÑ„Çã‰∫∫',
          '‚Ä¶ËàûÂè∞„ÇÑÊºîÂäá„Å´ÂèÇÂä†„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶‰ªä„ÇÇ‰Ωø„Å£„Å¶„ÅÑ„Çã„Éã„ÉÉ„ÇØ„Éç„Éº„É†„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Ç≥„É≥„ÉÜ„Çπ„Éà„ÇÑË≥û„ÇíÂèóË≥û„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Åä„Åô„Åô„ÇÅ„ÅÆ„ÅäÊ∞ó„Å´ÂÖ•„Çä„Éù„ÉÉ„Éâ„Ç≠„É£„Çπ„Éà„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Éê„Ç±„ÉÉ„Éà„É™„Çπ„Éà„Çí‰∏Ä„Å§ÈÅîÊàê„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÂÆöÁï™„ÅÆ„Ç´„É©„Ç™„Ç±Êõ≤„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Åù„ÅÆÂ†¥„ÅßÊúâÂêç‰∫∫„ÅÆ„É¢„Éé„Éû„Éç„Åå„Åß„Åç„Çã‰∫∫',
          '‚Ä¶Â§ßÂ•Ω„Åç„Å™Â§â„Çè„ÇäÁ®Æ„Éï„Éº„Éâ„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶‰∫∫„ÅÆÂêçÂâç„ÅÆ„Çà„ÅÜ„Å™„Éö„ÉÉ„Éà„ÅÆÂêçÂâç„Çí„Å§„Åë„Å¶„ÅÑ„Çã‰∫∫',
          '‚Ä¶„Ç®„ÇØ„Çπ„Éà„É™„Éº„É†„Çπ„Éù„Éº„ÉÑ„Å´ÊåëÊà¶„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÊúâÂêç‰∫∫„Å´ÈñìÈÅï„Åà„Çâ„Çå„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶„Éê„Ç∫„Å£„ÅüTikTok„ÇÑ„É™„Éº„É´„Åå„ÅÇ„ÇãÔºà„Åæ„Åü„ÅØÁü•„ÇäÂêà„ÅÑ„Å´„ÅÑ„ÇãÔºâ‰∫∫',
          '‚Ä¶„Å§„ÅÑ‰Ωø„ÅÑ„Åô„Åé„Çã„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÁµµÊñáÂ≠ó„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÔºàÂÜóË´á„ÅßÔºâ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈô∞Ë¨ÄË´ñ„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶ÂÖ±ÊÑü„Åô„Çã„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÊû∂Á©∫„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„ÅÑ„Çã‰∫∫',
          '‚Ä¶ÊóÖ„ÅÆÂ§±ÊïóË´á„ÇíÊåÅ„Å£„Å¶„ÅÑ„Çã‰∫∫',
          '‚Ä¶„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆ„Éú„Éâ„Ç≤„Éª„Éà„É©„É≥„Éó„Ç≤„Éº„É†„Åå„ÅÇ„Çã‰∫∫',
          '‚Ä¶Áµ∂ÂØæ„Å´È£ü„Åπ„Å™„ÅÑÈ£ü„ÅπÁâ©„Åå„ÅÇ„Çã‰∫∫'
        ]
      },
      id: {
        ui: {
          language: 'Bahasa:', dark: 'Mode Gelap', randomize: 'Acak papan', start: 'Mulai Bingo', reset: 'Reset',
          prehint: 'Sebelum mulai kamu bisa mengacak maksimal 3√ó.', howto: 'Ketuk ubin lalu isi nama + jawaban singkat. Buat garis untuk BINGO!',
          add: 'Tambah nama & jawaban', name: 'Nama', response: 'Jawaban singkat', cancel: 'Batal', save: 'Simpan',
          filled: (n)=>`${n}/16 terisi`, lines: (n)=>`${n} garis bingo`
        },
        facts: [
          '‚Ä¶sudah bekerja di perusahaan >10 tahun',
          '‚Ä¶punya bakat tersembunyi yang pernah ditampilkan',
          '‚Ä¶pernah ke lebih dari 5 negara',
          '‚Ä¶bisa berbicara lebih dari dua bahasa',
          '‚Ä¶pernah bertemu orang terkenal',
          '‚Ä¶pernah lari maraton atau tantangan kebugaran besar',
          '‚Ä¶punya peliharaan selain anjing/kucing',
          '‚Ä¶pernah tinggal di lebih dari tiga kota',
          '‚Ä¶punya bulan lahir yang sama denganmu',
          '‚Ä¶pernah kerja di industri yang sama sekali berbeda',
          '‚Ä¶punya side hustle atau proyek passion',
          '‚Ä¶bergabung kurang dari 6 bulan',
          '‚Ä¶punya hobi unik (contoh: beternak lebah, tembikar, anggar)',
          '‚Ä¶tidak pernah minum kopi',
          '‚Ä¶pernah tampil di TV atau radio',
          '‚Ä¶punya kembaran / adalah anak kembar',
          '‚Ä¶pernah skydiving atau bungee jumping',
          '‚Ä¶punya tato dengan cerita di baliknya',
          '‚Ä¶hadir di konser dalam 1 bulan terakhir',
          '‚Ä¶sudah baca >20 buku tahun ini',
          '‚Ä¶pernah kerja jarak jauh dari negara lain',
          '‚Ä¶mengoleksi sesuatu yang tidak biasa',
          '‚Ä¶pernah ikut produksi teater',
          '‚Ä¶punya nama panggilan yang masih dipakai',
          '‚Ä¶pernah menang kompetisi atau penghargaan',
          '‚Ä¶punya podcast favorit untuk direkomendasikan',
          '‚Ä¶sudah menuntaskan salah satu bucket list',
          '‚Ä¶punya lagu karaoke andalan',
          '‚Ä¶bisa menirukan selebritas saat itu juga',
          '‚Ä¶punya kombinasi makanan aneh tapi enak (katanya!)',
          '‚Ä¶punya hewan peliharaan bernama manusia',
          '‚Ä¶pernah coba olahraga ekstrem (dan selamat)',
          '‚Ä¶pernah disangka sebagai orang terkenal',
          '‚Ä¶punya TikTok/Reel viral (atau kenal yang punya)',
          '‚Ä¶punya emoji favorit yang sering dipakai',
          '‚Ä¶punya teori konspirasi favorit (sekadar seru-seruan)',
          '‚Ä¶punya tokoh fiksi favorit yang related',
          '‚Ä¶punya cerita gagal saat traveling',
          '‚Ä¶punya board game/kartu favorit',
          '‚Ä¶ada makanan yang sama sekali tidak mau dimakan'
        ]
      }
    };

    // =====================
    // Icon mapping (40 items)
    // =====================
    const ICONS = [
      { fa: 'fa-briefcase', emoji: 'üè¢' }, // 1
      { fa: 'fa-masks-theater', emoji: 'üé§' }, // 2 hidden talent performed
      { fa: 'fa-earth-americas', emoji: 'üåç' }, // 3 travelled >5 countries
      { fa: 'fa-language', emoji: 'üó£Ô∏è' }, // 4 speaks >2 languages
      { fa: 'fa-star', emoji: '‚≠ê' }, // 5 met someone famous
      { fa: 'fa-person-running', emoji: 'üèÉ' }, // 6 marathon / fitness
      { fa: 'fa-paw', emoji: 'ü¶é' }, // 7 non dog/cat pet
      { fa: 'fa-city', emoji: 'üèôÔ∏è' }, // 8 lived >3 cities
      { fa: 'fa-cake-candles', emoji: 'üéÇ' }, // 9 same birth month
      { fa: 'fa-rotate', emoji: 'üîÑ' }, // 10 different industry
      { fa: 'fa-lightbulb', emoji: 'üí°' }, // 11 side hustle
      { fa: 'fa-seedling', emoji: 'üÜï' }, // 12 <6 months
      { fa: 'fa-palette', emoji: 'üé®' }, // 13 unique hobby
      { fa: 'fa-mug-saucer', emoji: 'üö´‚òï' }, // 14 never coffee
      { fa: 'fa-tv', emoji: 'üì∫' }, // 15 TV or radio
      { fa: 'fa-people-pulling', emoji: 'üëØ' }, // 16 twin (closest available)
      { fa: 'fa-parachute-box', emoji: 'ü™Ç' }, // 17 skydiving/bungee (approx)
      { fa: 'fa-pen-nib', emoji: 'üñãÔ∏è' }, // 18 tattoo
      { fa: 'fa-music', emoji: 'üé∂' }, // 19 concert last month
      { fa: 'fa-book-open', emoji: 'üìö' }, // 20 >20 books
      { fa: 'fa-laptop-house', emoji: 'üíª' }, // 21 remote from another country
      { fa: 'fa-box-archive', emoji: 'üì¶' }, // 22 unusual collection
      { fa: 'fa-masks-theater', emoji: 'üé≠' }, // 23 theatre production
      { fa: 'fa-id-badge', emoji: 'üè∑Ô∏è' }, // 24 nickname
      { fa: 'fa-trophy', emoji: 'üèÜ' }, // 25 award
      { fa: 'fa-podcast', emoji: 'üéß' }, // 26 podcast
      { fa: 'fa-list-check', emoji: '‚úÖ' }, // 27 bucket list done
      { fa: 'fa-microphone', emoji: 'üé§' }, // 28 karaoke
      { fa: 'fa-face-grin-stars', emoji: 'üòé' }, // 29 celeb impression
      { fa: 'fa-burger', emoji: 'üçï' }, // 30 weird food combo
      { fa: 'fa-dog', emoji: 'üê∂' }, // 31 pet with human name
      { fa: 'fa-person-skiing', emoji: 'üèÑ' }, // 32 extreme sport (approx)
      { fa: 'fa-user-check', emoji: 'üëÄ' }, // 33 mistaken for famous (approx)
      { fa: 'fa-mobile-screen', emoji: 'üì±' }, // 34 viral tiktok/reel
      { fa: 'fa-face-grin', emoji: 'üòä' }, // 35 favourite emoji
      { fa: 'fa-user-secret', emoji: 'üõ∏' }, // 36 conspiracy (for fun)
      { fa: 'fa-hat-wizard', emoji: 'ü¶∏' }, // 37 fictional character relate (approx)
      { fa: 'fa-suitcase-rolling', emoji: 'üß≥' }, // 38 travel fail
      { fa: 'fa-chess-board', emoji: 'üé≤' }, // 39 board/card game
      { fa: 'fa-ban', emoji: 'üö´üçΩÔ∏è' }  // 40 refuse to eat
    ];

    // Pre-build emoji array for convenience (same order as ICONS)
    const EMOJI_FALLBACK = ICONS.map(x => x.emoji);

    // =====================
    // Element references
    // =====================
    const boardEl = document.getElementById('board');
    const randomBtn = document.getElementById('randomBtn');
    const startBtn  = document.getElementById('startBtn');
    const rndLeftEl = document.getElementById('rndLeft');
    const progressEl = document.getElementById('progress');
    const darkToggle = document.getElementById('darkToggle');
    const darkTag = document.getElementById('darkTag');

    const modal = document.getElementById('entryModal');
    const nameInput = document.getElementById('nameInput');
    const respInput = document.getElementById('respInput');
    const modalFact = document.getElementById('modalFact');
    const modalTitle = document.getElementById('modalTitle');
    const nameLabel = document.getElementById('nameLabel');
    const respLabel = document.getElementById('respLabel');
    const cancelBtn = document.getElementById('cancelBtn');
    const saveBtn = document.getElementById('saveBtn');

    const overlay = document.getElementById('bingoOverlay');
    const bingoText = document.getElementById('bingoText');

    const langSel = document.getElementById('langSel');
    const langLabel = document.getElementById('langLabel');

    const i18nEls = document.querySelectorAll('[data-i18n]');
    const preHint = document.getElementById('preHint');
    const howto = document.getElementById('howto');

    // =============
    // App state
    // =============
    /*
      completedLines uses a Set. When storing to localStorage we stringify it as an array
      and revive back to Set on load to avoid "has is not a function" errors.
    */
    let state = {
      lang: localStorage.getItem('wtaf-lang') || 'en',
      grid: [],            // 16 picked indices into facts
      answers: {},         // idx -> {name, resp}
      started: false,
      randomLeft: 3,
      completedLines: new Set(),
      bingoScale: 1
    };

    // ---------- Persist/Revive helpers for Set ----------
    function toSavableState(s){
      const copy = {...s};
      copy.completedLines = Array.from(s.completedLines || []);
      return copy;
    }
    function fromSavedState(s){
      if (!s) return null;
      const revived = {...s};
      revived.completedLines = new Set(Array.isArray(s.completedLines) ? s.completedLines : []);
      return revived;
    }

    function saveState(){
      localStorage.setItem('wtaf-state', JSON.stringify(toSavableState(state)));
      localStorage.setItem('wtaf-lang', state.lang);
    }
    function loadState(){
      try {
        const s = JSON.parse(localStorage.getItem('wtaf-state'));
        const revived = fromSavedState(s);
        if (revived && Array.isArray(revived.grid) && revived.grid.length===16) {
          state = {...state, ...revived};
        }
      } catch(e){ /* ignore */ }
    }

    // -------------- i18n application --------------
    function applyLang(){
      langSel.value = state.lang;
      langLabel.textContent = I18N[state.lang].ui.language;
      darkToggle.textContent = (state.lang==='ja'?'üåô „ÉÄ„Éº„ÇØ„É¢„Éº„Éâ': state.lang==='id'?'üåô Mode Gelap':'üåô Dark mode');
      preHint.textContent = I18N[state.lang].ui.prehint;
      howto.textContent = I18N[state.lang].ui.howto;
      modalTitle.textContent = I18N[state.lang].ui.add;
      nameLabel.textContent = I18N[state.lang].ui.name;
      respLabel.textContent = I18N[state.lang].ui.response;
      cancelBtn.textContent = I18N[state.lang].ui.cancel;
      saveBtn.textContent = I18N[state.lang].ui.save;
      i18nEls.forEach(el => el.textContent = I18N[state.lang].ui[el.dataset.i18n]);
      renderBoard();
      updateProgress();
      saveState();
    }

    // -------------- Utility --------------
    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    // Create a fresh 4x4 board by sampling 16 unique indices from 40 facts
    function randomiseGrid(){
      const indices = [...Array(40).keys()];
      shuffle(indices);
      state.grid = indices.slice(0,16);
      state.answers = {}; // reset any filled names/responses
      if (!(state.completedLines instanceof Set)) state.completedLines = new Set();
      state.completedLines.clear();
      state.bingoScale = 1; // reset bingo scale so first bingo is base size
      renderBoard();
      updateProgress();
      saveState();
    }

    function tileTextByIndex(idx){
      return I18N[state.lang].facts[state.grid[idx]];
    }
    function tileIconByIndex(idx){
      const factIdx = state.grid[idx];
      return ICONS[factIdx] || { fa: 'fa-circle-question', emoji: '‚ùì' };
    }

    // ------------------ Board rendering ------------------
    function renderBoard(){
      // defensive: ensure grid is at most 16 long
      if (!Array.isArray(state.grid) || state.grid.length !== 16) {
        // create a fresh grid if invalid
        randomiseGrid();
        return; // randomiseGrid will call renderBoard when ready
      }

      boardEl.innerHTML = '';

      // Use the actual grid length (defensive) ‚Äî this prevents accidental duplication
      const count = Math.min(16, state.grid.length);
      for (let idx=0; idx<count; idx++){
        const text = tileTextByIndex(idx);
        const icon = tileIconByIndex(idx);
        const tile = document.createElement('button');
        tile.className = 'tile';
        tile.setAttribute('data-index', idx);
        const entry = state.answers[idx];

        // NOTE (requested change): show ONLY one Name ‚Äî next to the arrow in the meta line.
        // Inside the details area we now show only the Response (no duplicate Name).
        tile.innerHTML = `
          <i class="fa-solid ${icon.fa} fa-icon" aria-hidden="true"></i>
          <span class="emoji-fallback" aria-hidden="true">${icon.emoji}</span>
          <div class="fact">${text}</div>
          <div class="meta">
            <span class="check" style="display:${entry? 'inline-flex':'none'}">‚úì</span>
            <span class="who" title="name">${entry ? '' + escapeHtml(entry.name) : ''}</span>
          </div>
          ${entry ? `<div class="entry"><div class="resp">${escapeHtml(entry.resp)}</div></div>` : ''}
        `;

        if (entry) tile.classList.add('filled');
        tile.addEventListener('click', ()=> onTileClick(idx, text));
        boardEl.appendChild(tile);
      }
      // After rendering, detect whether Font Awesome actually loaded to toggle FA/emoji
      detectFontAwesome();
    }

    // Escape user text to avoid XSS
    function escapeHtml(str){
      return str.replace(/[&<>\"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[s]));
    }

    // ------------------ Modal interaction ------------------
    let currentIdx = null; // the tile index currently being edited
    function onTileClick(idx, text){
      if (!state.started) return; // tiles become editable only after Start
      currentIdx = idx;
      modalFact.textContent = text;
      nameInput.value = state.answers[idx]?.name || '';
      respInput.value = state.answers[idx]?.resp || '';
      // Some mobile browsers throw on showModal; fall back to open attribute.
      try { modal.showModal(); } catch(e){ modal.setAttribute('open',''); }
      setTimeout(()=>nameInput.focus(), 50);
    }

    // Update the progress text ("x/16 filled ¬∑ y bingo lines")
    function updateProgress(){
      const filled = Object.keys(state.answers).length;
      const lines = calculateBingoLines();
      progressEl.textContent = `${I18N[state.lang].ui.filled(filled)} ¬∑ ${I18N[state.lang].ui.lines(lines.size)}`;
    }

    // Compute all completed lines as a Set of line indices (0..9)
    function calculateBingoLines(){
      const filled = new Set(Object.keys(state.answers).map(Number));
      const lines = [];
      for (let r=0;r<4;r++){ lines.push([0,1,2,3].map(c=>r*4+c)); } // rows
      for (let c=0;c<4;c++){ lines.push([0,1,2,3].map(r=>r*4+c)); } // columns
      lines.push([0,5,10,15]); // diag TL‚ÜíBR
      lines.push([3,6,9,12]); // diag TR‚ÜíBL
      const completed = new Set();
      lines.forEach((l,i)=>{ if(l.every(x=>filled.has(x))) completed.add(i); });
      return completed;
    }

    // If there are newly completed lines since last check, celebrate
    function checkForNewBingo(){
      const now = calculateBingoLines();
      const prev = (state.completedLines instanceof Set) ? state.completedLines : new Set();
      const newOnes = [...now].filter(i=>!prev.has(i));
      if (newOnes.length){
        state.completedLines = now;
        state.bingoScale *= 1.5; // 50% bigger each new BINGO
        playCrowdClap();         // gentle crowd clapping sound
        showBingo();             // confetti + overlay
      }
      updateProgress();
      saveState();
    }

    // Display scalable BINGO text + a short confetti burst; tap overlay to dismiss
    function showBingo(){
      overlay.classList.add('show');
      bingoText.style.transform = `scale(${state.bingoScale})`;
      bingoText.textContent = 'BINGO!';
      const duration = 1200;
      const end = Date.now() + duration;
      (function frame(){
        confetti({particleCount: 4, spread: 60, startVelocity: 28, origin: { x: Math.random(), y: Math.random()*0.3 }});
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }
    overlay.addEventListener('click', ()=> overlay.classList.remove('show'));

    // ------------------ Controls wiring ------------------
    randomBtn.addEventListener('click', ()=>{
      if (state.started) return;          // randomize disabled once the game starts
      if (state.randomLeft<=0) return;    // maximum 3 shuffles
      state.randomLeft--; rndLeftEl.textContent = state.randomLeft;
      randomiseGrid();
    });

    startBtn.addEventListener('click', ()=>{
      if (!state.started) {
        // Transition to started mode: lock randomize, change button to Reset, hide hint
        state.started = true; saveState();
        document.getElementById('preHint').style.display='none';
        startBtn.classList.remove('primary');
        startBtn.innerHTML = `‚Ü∫ ${I18N[state.lang].ui.reset}`;
        randomBtn.disabled = true;
        resumeAudio(); // prime WebAudio so we can play claps later
      } else {
        // Reset board: clear answers, bingos, scale; re-enable randomize and shuffle count
        state.started = false;
        state.answers = {};
        state.completedLines = new Set();
        state.bingoScale = 1;
        state.randomLeft = 3; rndLeftEl.textContent = '3';
        startBtn.classList.add('primary');
        startBtn.innerHTML = `‚ñ∂ ${I18N[state.lang].ui.start}`;
        randomBtn.disabled = false;
        renderBoard();
        updateProgress();
        saveState();
      }
    });

    darkToggle.addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
      const on = document.body.classList.contains('dark');
      darkToggle.setAttribute('aria-pressed', on?'true':'false');
      darkTag.textContent = on? '‚òæ Dark' : '‚òº Light';
      localStorage.setItem('wtaf-dark', on?'1':'0');
    });

    langSel.addEventListener('change', ()=>{ state.lang = langSel.value; applyLang(); });

    // Modal buttons
    saveBtn.addEventListener('click', (e)=>{
      e.preventDefault();
      const name = nameInput.value.trim();
      const resp = respInput.value.trim();
      if (!name || !resp) return; // both required
      state.answers[currentIdx] = {name, resp};
      try { modal.close(); } catch(e){ modal.removeAttribute('open'); }
      renderBoard();
      checkForNewBingo();
    });
    cancelBtn.addEventListener('click', (e)=>{ e.preventDefault(); try { modal.close(); } catch(e2){ modal.removeAttribute('open'); } });

    // ================================
    // Celebration sound: crowd clapping
    // ================================
    let audioCtx = null; let unlocked = false;
    function resumeAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      unlocked = true;
    }
    window.addEventListener('pointerdown', resumeAudio, { once: true });

    function noiseBuffer(){
      const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate*1.5, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for(let i=0;i<data.length;i++){ data[i] = Math.random()*2-1; }
      return buffer;
    }
    function playCrowdClap(){
      if (!unlocked) return; // respect autoplay policies
      const master = audioCtx.createGain();
      master.gain.value = 0.25; // gentle volume
      master.connect(audioCtx.destination);
      for(let i=0;i<7;i++){
        const t = audioCtx.currentTime + i*0.09;
        const src = audioCtx.createBufferSource(); src.buffer = noiseBuffer();
        const hp = audioCtx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1800;
        const g = audioCtx.createGain(); g.gain.setValueAtTime(0, t); g.gain.linearRampToValueAtTime(1, t+0.012); g.gain.exponentialRampToValueAtTime(0.0001, t+0.14);
        src.connect(hp).connect(g).connect(master);
        src.start(t); src.stop(t+0.22);
      }
    }

    // ====================
    // Font Awesome detect
    // ====================
    function detectFontAwesome(){
      try {
        if (document.fonts && document.fonts.check("1em 'Font Awesome 6 Free'")) {
          document.body.classList.add('fa-loaded');
        } else {
          document.body.classList.remove('fa-loaded');
        }
      } catch(e) {
        document.body.classList.remove('fa-loaded');
      }
    }

    // ====================
    // Boot sequence
    // ====================
    loadState();
    document.body.classList.toggle('dark', localStorage.getItem('wtaf-dark')==='1');
    rndLeftEl.textContent = state.randomLeft;
    applyLang();
    if (state.started) { // recover UI state after refresh
      startBtn.classList.remove('primary');
      startBtn.innerHTML = `‚Ü∫ ${I18N[state.lang].ui.reset}`;
      randomBtn.disabled = true;
    }

    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(detectFontAwesome);
    } else {
      setTimeout(detectFontAwesome, 500);
    }

    // ========================================================
    // Runtime tests (in console) to catch common regressions
    // ========================================================
    (function runTests(){
      console.groupCollapsed('WhoTheFact ‚Äì runtime tests');
      const tempState = { completedLines: new Set([1,2,7]) };
      const saved = JSON.stringify(toSavableState(tempState));
      const revived = fromSavedState(JSON.parse(saved));
      console.assert(revived.completedLines instanceof Set, 'completedLines should revive to Set');
      console.assert(revived.completedLines.has(7), 'revived set should contain 7');

      function bingoLinesFromAnswers(answers){
        const filled = new Set(Object.keys(answers).map(Number));
        const lines = [];
        for (let r=0;r<4;r++){ lines.push([0,1,2,3].map(c=>r*4+c)); }
        for (let c=0;c<4;c++){ lines.push([0,1,2,3].map(r=>r*4+c)); }
        lines.push([0,5,10,15]);
        lines.push([3,6,9,12]);
        const completed = new Set();
        lines.forEach((l,i)=>{ if(l.every(x=>filled.has(x))) completed.add(i); });
        return completed;
      }
      // Test 2: Row bingo
      const row = {0:{},1:{},2:{},3:{}};
      console.assert(bingoLinesFromAnswers(row).size===1, 'row should be 1 bingo');
      // Test 3: Column bingo
      const col = {0:{},4:{},8:{},12:{}};
      console.assert(bingoLinesFromAnswers(col).size===1, 'column should be 1 bingo');
      // Test 4: Diagonal bingo
      const diag = {0:{},5:{},10:{},15:{}};
      console.assert(bingoLinesFromAnswers(diag).size===1, 'diagonal should be 1 bingo');
      // Test 5: Two lines (row + column share cell 0)
      const two = {0:{},1:{},2:{},3:{},4:{},8:{},12:{}};
      console.assert(bingoLinesFromAnswers(two).size===2, 'two lines should be 2 bingos');
      console.groupEnd();
    })();
  </script>
</body>
</html>
