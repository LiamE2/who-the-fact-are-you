<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Who the Fact Are You? ‚Äî 4√ó4 Bingo</title>

<!-- Font Awesome (icons) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<style>
  /* ===============================
     Scaleable UI by changing --ui-font-size
     All major font sizes use rem so the A+/A- controls work.
     =============================== */
  :root{
    --ui-font-size: 16px; /* base UI font-size (changed by A+ / A-) */
    --brand-red:#e53935;
    --bg:#ffffff;
    --text:#111111;
    --muted:#6b7280;
    --tile:#fafafa;
    --tile-border:#ececec;
    --accent:#ef4444;
  }
  /* Dark theme token overrides */
  body.dark{
    --bg:#0b0e16; --text:#ffffff; --muted:#d1d5db; --tile:#111827; --tile-border:#1f2937; --accent:#f87171;
  }

  /* Basic resets */
  *{ box-sizing:border-box; }
  html { font-size: var(--ui-font-size); } /* changing this scales rem */
  body{
    margin:0;
    font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background:var(--bg);
    color:var(--text);
    -webkit-text-size-adjust:100%;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Outer red border requested */
  .app-wrapper{ min-height:100dvh; border:10px solid var(--brand-red); display:flex; flex-direction:column; }

  /* Header layout: grid so we can easily rearrange on mobile */
  header{
    padding: calc(0.75rem + 6px) 1rem;
    display:grid;
    grid-template-columns: auto 1fr auto;
    gap:0.75rem;
    align-items:center;
  }
  header .logo{ width:3.5rem; height:3.5rem; object-fit:contain; border-radius:0.5rem; background:#fff; }
  .brand .subtitle{ font-size:0.75rem; color:var(--muted); text-transform:uppercase; letter-spacing:0.08rem; margin:0 0 0.125rem 0; }
  .brand .title{ font-weight:800; font-size:clamp(1.25rem, 4.5vw, 2rem); margin:0; line-height:1; }

  /* Controls row ‚Äî keeps inputs at 16px to prevent iOS zoom on focus */
  .controls{ padding:0.5rem 1rem; display:flex; gap:0.5rem; flex-wrap:wrap; align-items:center; }
  .btn{ padding:0.5rem 0.75rem; border-radius:999px; border:1px solid var(--tile-border); background:var(--tile); cursor:pointer; color:var(--text); font-size:1rem; }
  .btn.primary{ background:var(--accent); color:#fff; border:none; }
  .hint{ font-size:0.8125rem; color:var(--muted); }

  /* Font-size controls (A- / A+) */
  .font-controls{ display:inline-flex; gap:0.5rem; align-items:center; }

  /* Board area: 4 columns; rows auto-size to tallest tile in row */
  .board-container{ padding:0.5rem 1rem 1rem; flex:1; }
  .board{
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:0.75rem;
    align-items:stretch; /* tiles in a row match the tallest */
  }

  /* Tile: flexible rectangles. Use rem & clamp to scale with base font-size */
  .tile{
    background:var(--tile);
    border:1px solid var(--tile-border);
    border-radius:0.875rem;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
    position:relative;
    padding:0.75rem 0.75rem 3.0rem 0.75rem; /* bottom padding reserves for icon */
    overflow:hidden;
    text-align:left;
    min-height:6.5rem; /* sensible minimum height */
    color:var(--text);
  }

  /* Fact text: bold and sized relative to root (rem) */
  .fact{ font-size:clamp(0.77rem, 2.4vw, 0.9375rem); line-height:1.25; font-weight:600; margin-bottom:0.5rem; word-break:break-word; color:var(--text); }
  .meta{ margin-top:auto; font-size:0.8125rem; color:var(--muted); display:flex; gap:0.5rem; align-items:center; }
  .entry{ margin-top:0.5rem; font-size:0.8125rem; color:var(--text); }
  .who{ font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:70%; }
  .resp{ margin-top:0.25rem; opacity:0.95; font-size:0.8125rem; }

  /* Icon bottom-right; OA fallback emoji if FA not available */
  .fa-icon{ position:absolute; right:0.625rem; bottom:0.625rem; opacity:.22; font-size:1.6rem; display:none; pointer-events:none; color:var(--text); }
  .emoji-fallback{ position:absolute; right:0.625rem; bottom:0.625rem; opacity:.22; font-size:1.6rem; display:inline-block; pointer-events:none; }
  body.fa-loaded .fa-icon{ display:inline-block; }
  body.fa-loaded .emoji-fallback{ display:none; }

  /* When tile is filled we want the icon more visible ‚Äî previously icons looked grey after submit */
  .tile.filled .fa-icon,
  .tile.filled .emoji-fallback {
    opacity: 0.85; /* make the icon/emoji clearly visible for filled tiles */
  }

  /* Filled tile visual */
  .tile.filled{ outline:3px solid #22c55e; background: linear-gradient(180deg, rgba(16,185,129,.06), transparent 50%); }

  /* Modal: follow theme and make prompt darker/easy to read */
  dialog.modal{
    border:none; border-radius:0.75rem; padding:0; width:min(40rem,94vw);
    background:var(--tile); color:var(--text);
  }
  dialog.modal::backdrop{ background: rgba(0,0,0,0.35); }
  .modal .inner{ padding:0.875rem; }
  .modal .hint{ color:var(--text); font-weight:700; margin-bottom:0.5rem; }
  .modal input, .modal textarea{
    width:100%; font-size:1rem; padding:0.5rem 0.75rem; border-radius:0.625rem; border:1px solid var(--tile-border);
    background:var(--bg); color:var(--text);
  }
  .modal .actions{ display:flex; justify-content:flex-end; gap:0.5rem; margin-top:0.5rem; }
  .modal .btn{ color:var(--text); background:transparent; border:1px solid var(--tile-border); padding:0.5rem 0.75rem; border-radius:0.5rem; }
  .modal .btn.primary{ background:var(--accent); color:#fff; border:none; }

  /* Bingo overlay */
  .bingo-overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.35); z-index:9999; }
  .bingo-overlay.show{ display:flex; }
  .bingo-text{ font-weight:900; font-size:4rem; color:#fff; text-shadow:0 6px 22px rgba(0,0,0,.55); }

  footer{ padding:0.5rem 1rem; display:flex; justify-content:space-between; align-items:center; font-size:0.8125rem; color:var(--muted); }

  /* Mobile header adjustments so title doesn't get shoved right */
  @media (max-width:700px){
    header{ grid-template-columns: auto 1fr; grid-template-rows:auto auto; gap:0.25rem; align-items:start; }
    .brand{ text-align:left; }
    .logo{ width:3.25rem; height:3.25rem; }
    .bingo-text{ font-size:3rem; }
    .tile{ padding:0.625rem 0.625rem 2.5rem 0.625rem; min-height:5.75rem; }
  }
</style>
</head>
<body>
  <div class="app-wrapper" id="app">
    <header>
      <!-- Logo: fallback to placeholder if hotlink fails -->
      <img class="logo" src="https://tse2.mm.bing.net/th/id/OIP.vB2_MMCK6wxXLJRR_2APTgAAAA?r=0&rs=1&pid=ImgDetMain&o=7&rm=3" alt="Engage Squared logo"
           onerror="this.src='https://via.placeholder.com/120x40?text=Engage+Squared'">

      <div class="brand">
        <div class="subtitle">ENGAGE SQUARED</div>
        <h1 class="title">Who the Fact Are You? üéâ</h1>
      </div>

      <!-- Right-side small controls -->
      <div class="controls" style="justify-self:end;">
        <select id="langSel" aria-label="Language" class="btn" title="Language">
          <option value="en">English</option>
          <option value="ja">Êó•Êú¨Ë™û</option>
          <option value="id">Bahasa Indonesia</option>
        </select>

        <!-- Dark mode toggle label updates dynamically -->
        <button id="darkToggle" class="btn" aria-pressed="false">üåô Dark mode</button>
      </div>
    </header>

    <!-- Top controls with randomise / start and font size buttons -->
    <div class="controls" style="padding:0.5rem 1rem;">
      <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
        <button id="randomBtn" class="btn">üîÄ <span data-i18n="randomize">Randomise board</span> (<span id="rndLeft">3</span>)</button>
        <button id="startBtn" class="btn primary">‚ñ∂ <span data-i18n="start">Start Bingo</span></button>

        <!-- Font size controls -->
        <div class="font-controls">
          <button id="fontDec" class="btn" title="Decrease font">A‚àí</button>
          <button id="fontInc" class="btn" title="Increase font">A+</button>
        </div>

        <div id="preHint" class="hint" style="margin-left:0.5rem;">You can shuffle up to 3√ó before starting.</div>
      </div>

      <div style="margin-left:auto;" class="hint" id="howto">Tap a tile to enter a name + a short response. Fill lines to get BINGO!</div>
    </div>

    <div class="board-container">
      <main id="board" class="board" aria-live="polite"></main>
    </div>

    <footer>
      <div id="progress">0/16 filled ¬∑ 0 bingo lines</div>
      <div>Made with ‚ù§Ô∏è by your friendly neighbourhood Liam</div>
    </footer>
  </div>

  <!-- Modal for entering name & response (follows current theme) -->
  <dialog class="modal" id="entryModal">
    <form method="dialog" class="inner" onsubmit="return false;">
      <h3 id="modalTitle">Add a name & response</h3>
      <div id="modalFact" class="hint" style="margin-bottom:8px;"></div>

      <label id="nameLabel" for="nameInput">Name</label>
      <input id="nameInput" type="text" placeholder="Type their name" required style="margin-bottom:8px;" />

      <label id="respLabel" for="respInput">Response</label>
      <textarea id="respInput" placeholder="A few words‚Ä¶" required></textarea>

      <div class="actions">
        <button id="cancelBtn" class="btn" value="cancel">Cancel</button>
        <button id="saveBtn" class="btn primary" value="confirm">Save</button>
      </div>
    </form>
  </dialog>

  <!-- Bingo overlay (tap to dismiss) -->
  <div class="bingo-overlay" id="bingoOverlay"><div class="bingo-text" id="bingoText">BINGO!</div></div>

  <!-- gentle crowd clap audio file (used on bingo) -->
  <audio id="clapAudio" preload="auto" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b4a41e8d27.mp3?filename=small-crowd-clapping-6695.mp3"></audio>

<script>
/* ================================
   Full app JavaScript
   Comments added inline to explain important parts
   ================================ */

/* ========= I18N & facts (EN/JA/ID) ========= */
/* UI strings + localized facts (complete) */
const I18N = {
  en: {
    ui: {
      language:'Language:', dark:'Dark mode', light:'Light mode', randomize:'Randomise board',
      start:'Start Bingo', reset:'Reset Board', prehint:'You can shuffle up to 3√ó before starting.',
      howto:'Tap a tile to enter a name + a short response. Fill lines to get BINGO!',
      add:'Add a name & response', name:'Name', response:'Response', cancel:'Cancel', save:'Save',
      filled:(n)=>`${n}/16 filled`, lines:(n)=>`${n} bingo line${n===1?'':'s'}`
    },
    facts: [
      '‚Ä¶has worked at the company for over 10 years',
      '‚Ä¶has a hidden talent they‚Äôve performed publicly',
      '‚Ä¶has travelled to more than 5 countries',
      '‚Ä¶speaks more than two languages',
      '‚Ä¶has met someone famous',
      '‚Ä¶has run a marathon or completed a major fitness challenge',
      '‚Ä¶has a pet that‚Äôs not a dog or cat',
      '‚Ä¶has lived in more than three cities',
      '‚Ä¶has the same birth month as you',
      '‚Ä¶has worked in a completely different industry before',
      '‚Ä¶has a side hustle or passion project',
      '‚Ä¶has been with the company less than 6 months',
      '‚Ä¶has a unique hobby (e.g., beekeeping, pottery, fencing)',
      '‚Ä¶has never had coffee',
      '‚Ä¶has been on TV or radio',
      '‚Ä¶has a twin or is a twin',
      '‚Ä¶has gone skydiving or bungee jumping',
      '‚Ä¶has a tattoo with a story behind it',
      '‚Ä¶has attended a concert in the last month',
      '‚Ä¶has read more than 20 books this year',
      '‚Ä¶has worked remotely from another country',
      '‚Ä¶has a collection of something unusual',
      '‚Ä¶has been part of a theatre production',
      '‚Ä¶has a nickname they still go by',
      '‚Ä¶has won a competition or award',
      '‚Ä¶has a favourite podcast they recommend',
      '‚Ä¶has a bucket list item they‚Äôve completed',
      '‚Ä¶has a go-to karaoke song',
      '‚Ä¶can do a celebrity impression on the spot',
      '‚Ä¶has a weird food combo they love (and will defend)',
      '‚Ä¶has a pet with a human name',
      '‚Ä¶has tried an extreme sport (and survived)',
      '‚Ä¶has been mistaken for someone famous',
      '‚Ä¶has a viral TikTok or Reel (or knows someone who does)',
      '‚Ä¶has a favourite emoji they overuse',
      '‚Ä¶has a favourite conspiracy theory (for fun!)',
      '‚Ä¶has a favourite fictional character they relate to',
      '‚Ä¶has a story about a travel fail',
      '‚Ä¶has a favourite board game or card game',
      '‚Ä¶has a food they refuse to eat under any circumstance'
    ]
  },

  ja: {
    ui: {
      language:'Ë®ÄË™ûÔºö', dark:'„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ', light:'„É©„Ç§„Éà„É¢„Éº„Éâ', randomize:'„Éú„Éº„Éâ„Çí„Ç∑„É£„ÉÉ„Éï„É´',
      start:'„Éì„É≥„Ç¥ÈñãÂßã', reset:'„É™„Çª„ÉÉ„Éà', prehint:'ÈñãÂßãÂâç„ÅØÊúÄÂ§ß3Âõû„Åæ„Åß„Ç∑„É£„ÉÉ„Éï„É´„Åß„Åç„Åæ„Åô„ÄÇ',
      howto:'„Çø„Ç§„É´„Çí„Çø„ÉÉ„Éó„Åó„Å¶„ÄåÂêçÂâç„Äç„Å®„Äå‰∏ÄË®Ä„Äç„ÇíÂÖ•Âäõ„ÄÇÂàó„ÉªË°å„ÉªÊñú„ÇÅ„Åå„Åù„Çç„ÅÜ„Å® BINGO!',
      add:'ÂêçÂâç„Å®‰∏ÄË®Ä„ÇíÂÖ•Âäõ', name:'ÂêçÂâç', response:'‰∏ÄË®Ä„É°„É¢', cancel:'„Ç≠„É£„É≥„Çª„É´', save:'‰øùÂ≠ò',
      filled:(n)=>`${n}/16 ÂÆå‰∫Ü`, lines:(n)=>`„Éì„É≥„Ç¥ ${n} „É©„Ç§„É≥`
    },
    facts: [
      '‚Ä¶Âã§Á∂ö10Âπ¥‰ª•‰∏ä„ÅÆ‰∫∫',
      '‚Ä¶‰∫∫Ââç„ÅßÊä´Èú≤„Åó„ÅüÈö†„Çå„ÅüÁâπÊäÄ„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶5„Ç´ÂõΩ‰ª•‰∏ä„Å´ÊóÖË°å„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶2Ë®ÄË™û‰ª•‰∏ä„ÇíË©±„Åõ„Çã‰∫∫',
      '‚Ä¶ÊúâÂêç‰∫∫„Å´‰ºö„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„Éï„É´„Éû„É©„ÇΩ„É≥„ÇÑÂ§ß„Åç„Å™ÈÅãÂãï„ÉÅ„É£„É¨„É≥„Ç∏„ÇíÈÅîÊàê„Åó„Åü‰∫∫',
      '‚Ä¶Áä¨„ÇÑÁå´‰ª•Â§ñ„ÅÆ„Éö„ÉÉ„Éà„Åå„ÅÑ„Çã‰∫∫',
      '‚Ä¶3ÈÉΩÂ∏Ç‰ª•‰∏ä„Å´‰Ωè„Çì„Å†„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„ÅÇ„Å™„Åü„Å®Âêå„ÅòË™ïÁîüÊúà„ÅÆ‰∫∫',
      '‚Ä¶ÂÖ®„ÅèÈÅï„ÅÜÊ•≠Áïå„ÅßÂÉç„ÅÑ„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÂâØÊ•≠„ÇÑÊÉÖÁÜ±ÁöÑ„Å´Âèñ„ÇäÁµÑ„ÇÄ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÂÖ•Á§æ6„Ç´ÊúàÊú™Ê∫Ä„ÅÆ‰∫∫',
      '‚Ä¶„É¶„Éã„Éº„ÇØ„Å™Ë∂£Âë≥Ôºà‰æãÔºöÈ§äËúÇ„ÄÅÈô∂Ëä∏„ÄÅ„Éï„Çß„É≥„Ç∑„É≥„Ç∞Ôºâ„ÇíÊåÅ„Å§‰∫∫',
      '‚Ä¶„Ç≥„Éº„Éí„Éº„ÇíÈ£≤„Çì„Å†„Åì„Å®„Åå„Å™„ÅÑ‰∫∫',
      '‚Ä¶„ÉÜ„É¨„Éì„ÇÑ„É©„Ç∏„Ç™„Å´Âá∫„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÂèåÂ≠ê„ÄÅ„Åæ„Åü„ÅØÂèåÂ≠ê„ÅÆÂÖÑÂºüÂßâÂ¶π„Åå„ÅÑ„Çã‰∫∫',
      '‚Ä¶„Çπ„Ç´„Ç§„ÉÄ„Ç§„Éì„É≥„Ç∞„ÇÑ„Éê„É≥„Ç∏„Éº„Ç∏„É£„É≥„Éó„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶Áâ©Ë™û„ÅÆ„ÅÇ„Çã„Çø„Éà„Ç•„Éº„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÈÅéÂéª1„Ç´Êúà„Åß„Ç≥„É≥„Çµ„Éº„Éà„Å´Ë°å„Å£„Åü‰∫∫',
      '‚Ä¶‰ªäÂπ¥20ÂÜä‰ª•‰∏äÊú¨„ÇíË™≠„Çì„Å†‰∫∫',
      '‚Ä¶Êµ∑Â§ñ„Åß„É™„É¢„Éº„Éà„ÉØ„Éº„ÇØ„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶Áèç„Åó„ÅÑ„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÇíÈõÜ„ÇÅ„Å¶„ÅÑ„Çã‰∫∫',
      '‚Ä¶ÊºîÂäá„Å´ÂèÇÂä†„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶‰ªä„ÇÇ‰Ωø„Å£„Å¶„ÅÑ„Çã„Éã„ÉÉ„ÇØ„Éç„Éº„É†„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„Ç≥„É≥„ÉÜ„Çπ„Éà„ÇÑË≥û„ÇíÂèóË≥û„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„Åä„Åô„Åô„ÇÅ„ÅÆ„Éù„ÉÉ„Éâ„Ç≠„É£„Çπ„Éà„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„Éê„Ç±„ÉÉ„Éà„É™„Çπ„Éà„ÇíÈÅîÊàê„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„Ç´„É©„Ç™„Ç±„ÅÆÂçÅÂÖ´Áï™„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÊúâÂêç‰∫∫„ÅÆ„É¢„Éé„Éû„Éç„Åå„Åß„Åç„Çã‰∫∫',
      '‚Ä¶Â§â„Çè„Å£„ÅüÈ£ü„ÅπÂêà„Çè„Åõ„ÅåÂ•Ω„Åç„Å™‰∫∫Ôºà„Åù„Åó„Å¶Ë≠≤„Çâ„Å™„ÅÑÔºâ',
      '‚Ä¶‰∫∫Èñì„ÅÆÂêçÂâç„ÅÆ„Éö„ÉÉ„Éà„Åå„ÅÑ„Çã‰∫∫',
      '‚Ä¶„Ç®„ÇØ„Çπ„Éà„É™„Éº„É†„Çπ„Éù„Éº„ÉÑ„Çí„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫ÔºàÁîüÈÇÑÊ∏à„ÅøÔºâ',
      '‚Ä¶ÊúâÂêç‰∫∫„Å´ÈñìÈÅï„Åà„Çâ„Çå„Åü„Åì„Å®„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„Éê„Ç∫„Å£„ÅüTikTok/„É™„Éº„É´„Åå„ÅÇ„ÇãÔºà„ÇÇ„Åó„Åè„ÅØÁü•„ÇäÂêà„ÅÑ„Å´„ÅÑ„ÇãÔºâ',
      '‚Ä¶„Å§„ÅÑÂ§öÁî®„Åó„Å¶„Åó„Åæ„ÅÜ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÁµµÊñáÂ≠ó„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÔºàÂ®ØÊ•Ω„Å®„Åó„Å¶Ôºâ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈô∞Ë¨ÄË´ñ„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶ÂÖ±ÊÑü„Åô„Çã„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÊû∂Á©∫„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„ÅÑ„Çã‰∫∫',
      '‚Ä¶ÊóÖ„ÅÆÂ§±ÊïóË´á„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆ„Éú„Éâ„Ç≤„Éª„Éà„É©„É≥„Éó„Ç≤„Éº„É†„Åå„ÅÇ„Çã‰∫∫',
      '‚Ä¶Áµ∂ÂØæ„Å´È£ü„Åπ„Å™„ÅÑÈ£ü„ÅπÁâ©„Åå„ÅÇ„Çã‰∫∫'
    ]
  },

  id: {
    ui: {
      language:'Bahasa:', dark:'Mode Gelap', light:'Mode Terang', randomize:'Acak papan',
      start:'Mulai Bingo', reset:'Reset', prehint:'Sebelum mulai kamu bisa mengacak maksimal 3√ó.',
      howto:'Ketuk ubin lalu isi nama + jawaban singkat. Buat garis untuk BINGO!', add:'Tambah nama & jawaban',
      name:'Nama', response:'Jawaban singkat', cancel:'Batal', save:'Simpan',
      filled:(n)=>`${n}/16 terisi`, lines:(n)=>`${n} garis bingo`
    },
    facts: [
      '‚Ä¶sudah bekerja di perusahaan lebih dari 10 tahun',
      '‚Ä¶punya bakat tersembunyi yang pernah ditampilkan',
      '‚Ä¶pernah ke lebih dari 5 negara',
      '‚Ä¶bisa berbicara lebih dari dua bahasa',
      '‚Ä¶pernah bertemu orang terkenal',
      '‚Ä¶pernah ikut marathon atau tantangan kebugaran besar',
      '‚Ä¶punya hewan peliharaan selain anjing/kucing',
      '‚Ä¶pernah tinggal di lebih dari tiga kota',
      '‚Ä¶punya bulan lahir yang sama denganmu',
      '‚Ä¶pernah bekerja di industri yang berbeda sama sekali',
      '‚Ä¶punya usaha sampingan atau proyek passion',
      '‚Ä¶bergabung kurang dari 6 bulan',
      '‚Ä¶punya hobi unik (mis. beternak lebah, tembikar, anggar)',
      '‚Ä¶tidak pernah minum kopi',
      '‚Ä¶pernah tampil di TV atau radio',
      '‚Ä¶punya saudara kembar atau dia kembar',
      '‚Ä¶pernah skydiving atau bungee jumping',
      '‚Ä¶punya tato dengan cerita di baliknya',
      '‚Ä¶pernah nonton konser bulan lalu',
      '‚Ä¶tahun ini baca lebih dari 20 buku',
      '‚Ä¶pernah kerja jarak jauh dari negara lain',
      '‚Ä¶punya koleksi yang tidak biasa',
      '‚Ä¶pernah ikut produksi teater',
      '‚Ä¶punya nama panggilan yang masih dipakai',
      '‚Ä¶pernah menang kompetisi atau mendapat penghargaan',
      '‚Ä¶punya podcast favorit yang direkomendasikan',
      '‚Ä¶pernah menuntaskan item di bucket list',
      '‚Ä¶punya lagu andalan saat karaoke',
      '‚Ä¶bisa menirukan selebriti dengan cepat',
      '‚Ä¶punya kombinasi makanan aneh yang disukai (dan dibela)',
      '‚Ä¶punya hewan peliharaan dengan nama manusia',
      '‚Ä¶pernah mencoba olahraga ekstrem (dan selamat)',
      '‚Ä¶pernah dikira orang terkenal',
      '‚Ä¶punya TikTok atau Reel viral (atau kenal yang punya)',
      '‚Ä¶punya emoji favorit yang sering dipakai',
      '‚Ä¶punya teori konspirasi favorit (hanya untuk bersenang-senang)',
      '‚Ä¶punya karakter fiksi favorit yang dirasa mirip dengan dirinya',
      '‚Ä¶punya cerita gagal saat bepergian',
      '‚Ä¶punya board game atau permainan kartu favorit',
      '‚Ä¶ada makanan yang sama sekali tidak mau dimakan'
    ]
  }
};

/* =================================
   Per-question icons (FA + emoji fallback)
   One-to-one mapping to questions array order
   ================================= */
const ICONS = [
  { fa:'fa-briefcase', emoji:'üè¢' }, { fa:'fa-masks-theater', emoji:'üé§' }, { fa:'fa-earth-americas', emoji:'üåç' },
  { fa:'fa-language', emoji:'üó£Ô∏è' }, { fa:'fa-star', emoji:'‚≠ê' }, { fa:'fa-person-running', emoji:'üèÉ' },
  { fa:'fa-paw', emoji:'ü¶é' }, { fa:'fa-city', emoji:'üèôÔ∏è' }, { fa:'fa-cake-candles', emoji:'üéÇ' },
  { fa:'fa-rotate', emoji:'üîÑ' }, { fa:'fa-lightbulb', emoji:'üí°' }, { fa:'fa-seedling', emoji:'üÜï' },
  { fa:'fa-palette', emoji:'üé®' }, { fa:'fa-mug-saucer', emoji:'üö´‚òï' }, { fa:'fa-tv', emoji:'üì∫' },
  { fa:'fa-people-arrows', emoji:'üëØ' }, { fa:'fa-parachute-box', emoji:'ü™Ç' }, { fa:'fa-pen-nib', emoji:'üñãÔ∏è' },
  { fa:'fa-music', emoji:'üé∂' }, { fa:'fa-book-open', emoji:'üìö' }, { fa:'fa-laptop-house', emoji:'üíª' },
  { fa:'fa-box-archive', emoji:'üì¶' }, { fa:'fa-masks-theater', emoji:'üé≠' }, { fa:'fa-id-badge', emoji:'üè∑Ô∏è' },
  { fa:'fa-trophy', emoji:'üèÜ' }, { fa:'fa-podcast', emoji:'üéß' }, { fa:'fa-list-check', emoji:'‚úÖ' },
  { fa:'fa-microphone', emoji:'üé§' }, { fa:'fa-face-grin-stars', emoji:'üòé' }, { fa:'fa-burger', emoji:'üçï' },
  { fa:'fa-dog', emoji:'üê∂' }, { fa:'fa-person-skiing', emoji:'üèÑ' }, { fa:'fa-user-check', emoji:'üëÄ' },
  { fa:'fa-mobile-screen', emoji:'üì±' }, { fa:'fa-face-grin', emoji:'üòä' }, { fa:'fa-user-secret', emoji:'üõ∏' },
  { fa:'fa-hat-wizard', emoji:'ü¶∏' }, { fa:'fa-suitcase-rolling', emoji:'üß≥' }, { fa:'fa-chess-board', emoji:'üé≤' },
  { fa:'fa-ban', emoji:'üö´üçΩÔ∏è' }
];

/* ===========================
   Element references
   =========================== */
const boardEl = document.getElementById('board');
const randomBtn = document.getElementById('randomBtn');
const startBtn = document.getElementById('startBtn');
const rndLeftEl = document.getElementById('rndLeft');
const progressEl = document.getElementById('progress');
const darkToggle = document.getElementById('darkToggle');
const langSel = document.getElementById('langSel');
const preHint = document.getElementById('preHint');
const howto = document.getElementById('howto');
const entryModal = document.getElementById('entryModal');
const nameInput = document.getElementById('nameInput');
const respInput = document.getElementById('respInput');
const modalFact = document.getElementById('modalFact');
const modalTitle = document.getElementById('modalTitle');
const cancelBtn = document.getElementById('cancelBtn');
const saveBtn = document.getElementById('saveBtn');
const bingoOverlay = document.getElementById('bingoOverlay');
const bingoText = document.getElementById('bingoText');
const clapAudio = document.getElementById('clapAudio');
const fontIncBtn = document.getElementById('fontInc');
const fontDecBtn = document.getElementById('fontDec');

/* ===========================
   App state (persisted)
   completedLines handled as Set and correctly serialized
   =========================== */
let state = {
  lang: localStorage.getItem('wtaf-lang') || 'en',
  grid: [],
  answers: {},
  started: false,
  randomLeft: 3,
  completedLines: new Set(),
  bingoScale: 1
};

/* ---------- Persist helpers ----------
   Save/Load state while converting Set -> Array and back.
*/
function toSavableState(s){
  const copy = {...s};
  copy.completedLines = Array.from(s.completedLines || []);
  return copy;
}
function fromSavedState(s){
  if (!s) return null;
  const revived = {...s};
  revived.completedLines = new Set(Array.isArray(s.completedLines) ? s.completedLines : []);
  return revived;
}
function saveState(){
  try{
    localStorage.setItem('wtaf-state', JSON.stringify(toSavableState(state)));
    localStorage.setItem('wtaf-lang', state.lang);
  }catch(e){ console.warn('save failed', e); }
}
function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem('wtaf-state'));
    const revived = fromSavedState(s);
    if (revived && Array.isArray(revived.grid) && revived.grid.length===16){
      state = {...state, ...revived};
    }
  }catch(e){ /* ignore invalid saved state */ }
}

/* ---------- i18n apply ----------
   Update some visible strings and re-render board
*/
function applyLang(){
  langSel.value = state.lang;
  const ui = I18N[state.lang] && I18N[state.lang].ui ? I18N[state.lang].ui : I18N.en.ui;
  preHint.textContent = ui.prehint;
  howto.textContent = ui.howto;
  modalTitle.textContent = ui.add;
  // update start/reset label if needed
  if (state.started) startBtn.innerHTML = `‚Ü∫ ${ui.reset}`; else startBtn.innerHTML = `‚ñ∂ ${ui.start}`;
  renderBoard();
  updateProgress();
  saveState();
  updateDarkToggleLabel(); // refresh dark toggle label if language changed
}

/* ---------- Small helpers ---------- */
function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}
function safeEscape(str){
  if (str === null || str === undefined) return '';
  return String(str).replace(/[&<>\"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[s]));
}

/* ---------- Board logic ----------
   Create a 4x4 board by sampling 16 unique indices from the facts list
*/
function randomiseGrid(){
  const total = I18N.en.facts.length;
  const indices = [...Array(total).keys()];
  shuffleArray(indices);
  state.grid = indices.slice(0,16);
  state.answers = {};
  if (!(state.completedLines instanceof Set)) state.completedLines = new Set();
  state.completedLines.clear();
  state.bingoScale = 1;
  renderBoard(); updateProgress(); saveState();
}
function tileTextByIndex(idx){
  const facts = (I18N[state.lang] && I18N[state.lang].facts) ? I18N[state.lang].facts : I18N.en.facts;
  return facts && facts[state.grid[idx]] ? String(facts[state.grid[idx]]) : '';
}
function tileIconByIndex(idx){
  const factIdx = state.grid[idx];
  return ICONS[factIdx] || { fa:'fa-circle-question', emoji:'‚ùì' };
}

/* ---------- Render board ----------
   Build tiles as buttons (keyboard & a11y friendly)
*/
function renderBoard(){
  if (!Array.isArray(state.grid) || state.grid.length !== 16){
    randomiseGrid(); return;
  }
  boardEl.innerHTML = '';
  for (let i=0;i<16;i++){
    const fact = tileTextByIndex(i);
    const icon = tileIconByIndex(i);
    const entry = state.answers[i];
    const tile = document.createElement('button');
    tile.type = 'button';
    tile.className = 'tile';
    tile.dataset.index = i;

    // show only one Name in meta line and only Response below ‚Äî no duplicate Name
    tile.innerHTML = `
      <i class="fa-solid ${icon.fa} fa-icon" aria-hidden="true"></i>
      <span class="emoji-fallback" aria-hidden="true">${icon.emoji}</span>
      <div class="fact">${safeEscape(fact)}</div>
      <div class="meta"><span class="who">${ entry ? safeEscape(entry.name) : '' }</span></div>
      ${ entry ? `<div class="entry"><div class="resp">${safeEscape(entry.resp)}</div></div>` : '' }
    `;

    if (entry) tile.classList.add('filled');
    // when clicked open modal to edit (only if started)
    tile.addEventListener('click', ()=> onTileClick(i, fact));
    boardEl.appendChild(tile);
  }
  detectFontAwesome();
}

/* ---------- Modal handling ----------
   currentIdx tracks which tile is being edited
*/
let currentIdx = null;
function onTileClick(idx, fact){
  if (!state.started) return;
  currentIdx = idx;
  modalFact.textContent = fact;
  nameInput.value = state.answers[idx]?.name || '';
  respInput.value = state.answers[idx]?.resp || '';
  try { entryModal.showModal(); } catch(e){ entryModal.setAttribute('open',''); }
  // focus input (small delay to avoid issues on some mobile)
  setTimeout(()=> nameInput.focus(), 50);
}

/* Save handler for modal */
saveBtn.addEventListener('click', (e)=>{
  e.preventDefault();
  const name = nameInput.value.trim();
  const resp = respInput.value.trim();
  if (!name || !resp) return; // require both
  state.answers[currentIdx] = { name, resp };
  try { entryModal.close(); } catch(e){ entryModal.removeAttribute('open'); }
  renderBoard();
  checkForNewBingo();
  updateProgress();
  saveState();
});
cancelBtn.addEventListener('click', (e)=>{ e.preventDefault(); try { entryModal.close(); } catch(e){ entryModal.removeAttribute('open'); } });

/* ---------- Bingo detection & progress ----------
   Row/column/diag detection for 4x4 grid
*/
function calculateBingoLines(){
  const filled = new Set(Object.keys(state.answers).map(Number));
  const lines = [];
  for (let r=0;r<4;r++) lines.push([0,1,2,3].map(c=>r*4+c));
  for (let c=0;c<4;c++) lines.push([0,1,2,3].map(r=>r*4+c));
  lines.push([0,5,10,15]); lines.push([3,6,9,12]);
  const completed = new Set();
  lines.forEach((l,i)=>{ if (l.every(x=>filled.has(x))) completed.add(i); });
  return completed;
}
function updateProgress(){
  const filled = Object.keys(state.answers).length;
  const lines = calculateBingoLines();
  progressEl.textContent = `${I18N[state.lang].ui.filled(filled)} ¬∑ ${I18N[state.lang].ui.lines(lines.size)}`;
}

/* Check and celebrate new bingoes */
function checkForNewBingo(){
  const now = calculateBingoLines();
  const prev = (state.completedLines instanceof Set) ? state.completedLines : new Set();
  const newOnes = [...now].filter(i=>!prev.has(i));
  if (newOnes.length){
    state.completedLines = now;
    state.bingoScale *= 1.5; // scale up BINGO size 50% each new bingo
    playClapSound();
    showBingo();
  }
  updateProgress();
  saveState();
}

/* ---------- Confetti + overlay ----------
   Show confetti for ~1.2s and a big scalable BINGO text.
*/
function showBingo(){
  bingoOverlay.classList.add('show');
  bingoText.style.transform = `scale(${state.bingoScale})`;
  bingoText.textContent = 'BINGO!';
  const duration = 1200; const end = Date.now() + duration;
  (function frame(){
    confetti({ particleCount: 6, spread: 60, startVelocity: 32, origin: { x: Math.random(), y: Math.random()*0.35 }});
    if (Date.now() < end) requestAnimationFrame(frame);
  })();
}
bingoOverlay.addEventListener('click', ()=> bingoOverlay.classList.remove('show'));

/* ---------- Audio: gentle crowd clap ----------
   Try using <audio> clip first for consistent volume; fallback to WebAudio noise bursts.
*/
let audioCtx = null, unlocked = false;
function resumeAudio(){ if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); unlocked = true; }
window.addEventListener('pointerdown', resumeAudio, { once:true });

function playClapSound(){
  // prefer audio element (gentle volume)
  if (clapAudio && typeof clapAudio.play === 'function'){
    try { clapAudio.volume = 0.28; clapAudio.currentTime = 0; clapAudio.play().catch(()=>{}); } catch(e){}
    return;
  }
  // fallback create short noise-ish bursts
  if (!unlocked) return;
  const master = audioCtx.createGain(); master.gain.value = 0.2; master.connect(audioCtx.destination);
  for (let i=0;i<6;i++){
    const t = audioCtx.currentTime + i*0.08; const dur = 0.18;
    const buf = audioCtx.createBuffer(1, audioCtx.sampleRate * dur, audioCtx.sampleRate);
    const data = buf.getChannelData(0);
    for (let k=0;k<data.length;k++) data[k] = (Math.random()*2-1) * Math.pow(1 - k/data.length, 2);
    const src = audioCtx.createBufferSource(); src.buffer = buf;
    const hp = audioCtx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value = 1600;
    const g = audioCtx.createGain(); g.gain.setValueAtTime(0.0001, t); g.gain.linearRampToValueAtTime(1, t+0.01); g.gain.exponentialRampToValueAtTime(0.00001, t+0.16);
    src.connect(hp).connect(g).connect(master); src.start(t); src.stop(t+dur);
  }
}

/* ---------- Font Awesome detection for fallback emoji ----------
   If FA loaded, show FA icons; otherwise show the emoji fallback
*/
function detectFontAwesome(){
  try{ if (document.fonts && document.fonts.check("1em 'Font Awesome 6 Free'")) document.body.classList.add('fa-loaded'); else document.body.classList.remove('fa-loaded'); } catch(e){ document.body.classList.remove('fa-loaded'); }
}

/* ---------- Controls wiring ----------
   Randomise, Start/Reset, Dark toggle, Language selector
*/
randomBtn.addEventListener('click', ()=>{
  if (state.started) return;
  if (state.randomLeft <= 0) return;
  state.randomLeft--; rndLeftEl.textContent = state.randomLeft;
  randomiseGrid();
});

startBtn.addEventListener('click', ()=>{
  const ui = I18N[state.lang].ui;
  if (!state.started){
    state.started = true; saveState();
    preHint.style.display = 'none';
    startBtn.classList.remove('primary');
    startBtn.innerHTML = `‚Ü∫ ${ui.reset}`;
    randomBtn.disabled = true;
    resumeAudio();
  } else {
    // Reset board: clear answers & restore shuffle allowance
    state.started = false; state.answers = {}; state.completedLines = new Set(); state.bingoScale = 1;
    state.randomLeft = 3; rndLeftEl.textContent = '3';
    startBtn.classList.add('primary'); startBtn.innerHTML = `‚ñ∂ ${ui.start}`;
    randomBtn.disabled = false;
    renderBoard(); updateProgress(); saveState();
  }
});

/* Dark toggle updates label to show sun emoji in dark mode */
function updateDarkToggleLabel(){
  const ui = (I18N[state.lang] && I18N[state.lang].ui) ? I18N[state.lang].ui : I18N.en.ui;
  if (document.body.classList.contains('dark')) {
    darkToggle.textContent = `‚òÄ ${ui.light || 'Light mode'}`;
  } else {
    darkToggle.textContent = `üåô ${ui.dark || 'Dark mode'}`;
  }
}
darkToggle.addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
  darkToggle.setAttribute('aria-pressed', document.body.classList.contains('dark') ? 'true' : 'false');
  localStorage.setItem('wtaf-dark', document.body.classList.contains('dark') ? '1':'0');
  updateDarkToggleLabel();
});

/* Language selector ‚Äî re-render board text when changed */
langSel.addEventListener('change', ()=>{ state.lang = langSel.value; applyLang(); });

/* ---------- Font size controls (A- / A+) ----------
   Persist font size in localStorage, clamp it to [12..22] px for safety.
*/
const FONT_MIN = 12, FONT_MAX = 22;
function getSavedFontSize(){
  const val = parseInt(localStorage.getItem('wtaf-fontsize') || '', 10);
  return Number.isFinite(val) ? val : 16;
}
function setFontSize(px){
  const clamped = Math.max(FONT_MIN, Math.min(FONT_MAX, Math.round(px)));
  document.documentElement.style.setProperty('--ui-font-size', clamped + 'px');
  localStorage.setItem('wtaf-fontsize', String(clamped));
}
fontIncBtn.addEventListener('click', ()=> {
  const cur = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--ui-font-size') || '16', 10);
  setFontSize(cur + 1);
});
fontDecBtn.addEventListener('click', ()=> {
  const cur = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--ui-font-size') || '16', 10);
  setFontSize(cur - 1);
});

/* ---------- Boot sequence ----------
   Load state, set dark mode & font size preferences, detect fonts, initialize UI.
*/
loadState();
document.body.classList.toggle('dark', localStorage.getItem('wtaf-dark') === '1');
rndLeftEl.textContent = state.randomLeft;

// Apply saved font size if present (before rendering so text uses it)
setFontSize(getSavedFontSize());

// Set language UI & render
applyLang();

// If started when last saved, restore start button as Reset
if (state.started){
  startBtn.classList.remove('primary');
  startBtn.innerHTML = `‚Ü∫ ${I18N[state.lang].ui.reset}`;
  randomBtn.disabled = true;
}

// Detect Font Awesome availability and enable icons
if (document.fonts && document.fonts.ready) document.fonts.ready.then(detectFontAwesome);
else setTimeout(detectFontAwesome, 400);

/* Small runtime self-tests (console) to catch regressions */
(function runSelfTests(){
  console.groupCollapsed('WTFAY self-tests');
  const temp = { completedLines: new Set([1,2,7]) };
  const s = JSON.stringify(toSavableState(temp));
  const r = fromSavedState(JSON.parse(s));
  console.assert(r.completedLines instanceof Set, 'completedLines revived to Set');
  console.assert(r.completedLines.has(7), 'revived set contains 7');

  function bingoLinesFromAnswers(answers){
    const filled = new Set(Object.keys(answers).map(Number));
    const lines = [];
    for (let r=0;r<4;r++) lines.push([0,1,2,3].map(c=>r*4+c));
    for (let c=0;c<4;c++) lines.push([0,1,2,3].map(r=>r*4+c));
    lines.push([0,5,10,15]); lines.push([3,6,9,12]);
    const completed = new Set();
    lines.forEach((l,i)=>{ if (l.every(x=>filled.has(x))) completed.add(i); });
    return completed;
  }
  console.assert(bingoLinesFromAnswers({0:{},1:{},2:{},3:{}}).size===1,'row bingo');
  console.assert(bingoLinesFromAnswers({0:{},4:{},8:{},12:{}}).size===1,'column bingo');
  console.assert(bingoLinesFromAnswers({0:{},5:{},10:{},15:{}}).size===1,'diag bingo');
  console.groupEnd();
})();
</script>
</body>
</html>
